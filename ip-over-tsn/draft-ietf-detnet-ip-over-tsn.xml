<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc iprnotified="no"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std"
     docName="draft-ietf-detnet-ip-over-tsn-00"
     ipr="trust200902"
     submissionType="IETF">
  <front>
    <title abbrev="DetNet IP over TSN">
    DetNet Data Plane: IP over IEEE 802.1 Time Sensitive Networking (TSN)</title>

    <author role="editor" fullname="Bal&aacute;zs Varga" initials="B." surname="Varga">
      <organization>Ericsson</organization>
      <address>
        <postal>
          <street>Magyar Tudosok krt. 11.</street>
          <city>Budapest</city>
          <country>Hungary</country>
          <code>1117</code>
        </postal>
        <email>balazs.a.varga@ericsson.com</email>
      </address>
    </author>

    <author fullname="J&aacute;nos Farkas" initials="J." surname="Farkas">
      <organization>Ericsson</organization>
      <address>
        <postal>
          <street>Magyar Tudosok krt. 11.</street>
          <city>Budapest</city>
          <country>Hungary</country>
          <code>1117</code>
        </postal>
        <email>janos.farkas@ericsson.com</email>
      </address>
    </author>

    <author fullname="Andrew G. Malis" initials="A.G." surname="Malis">
      <organization>Futurewei Technologies</organization>
      <address>
        <email>agmalis@gmail.com</email>
      </address>
    </author>

    <author fullname="Stewart Bryant" initials="S." surname="Bryant">
      <organization>Futurewei Technologies</organization>
      <address>
        <email>stewart.bryant@gmail.com</email>
      </address>
    </author>

    <author fullname="Jouni Korhonen" initials="J." surname="Korhonen">
      <!--organization abbrev="Nordic">Nordic Semiconductor</organization-->
      <address>
        <email>jouni.nospam@gmail.com</email>
      </address>
    </author>

    <!--author fullname="Donald Fauntleroy Duck" initials="D. F." surname="Duck">
        <organization abbrev="Royal Bros.">Royal Bros.</organization>
        <address>
        <postal>
        <street>13 Paradise Road</street>
        <city>Duckburg</city>
        <region>Calisota</region>
        <country>USA</country>
        </postal>
        </address>
        </author-->
    <date />
    <workgroup>DetNet</workgroup>

    <abstract>
      <t>
     This document specifies the Deterministic Networking IP data plane
     when operating over a TSN network.
      </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction" anchor="sec_intro">
      <t>
        [Editor's note: Introduction to be made specific to DetNet IP over TSN scenario. 
		May be similar to intro of DetNet MPLS over TSN.].
      </t>
      <t>
        Deterministic Networking (DetNet) is a service that can be offered by a network to DetNet flows.
        DetNet provides these flows extremely low packet loss rates and assured maximum end-to-end
        delivery latency.  General background and concepts of DetNet can
        be found in the DetNet Architecture <xref target="I-D.ietf-detnet-architecture"/>.
      </t>
      <t>
        This document specifies the DetNet data plane operation for IP
        hosts and routers that provide DetNet service to IP encapsulated
        data.  No DetNet specific encapsulation is defined to support IP
        flows, rather existing IP and higher layer protocol header information is used to support
        flow identification and DetNet service delivery.
      </t>
      <t>
        The DetNet Architecture decomposes the DetNet related data plane
        functions into two sub-layers: a service sub-layer and a forwarding
        sub-layer.  The service sub-layer is used to provide DetNet service
        protection and reordering. The forwarding sub-layer is used to
        provides congestion protection (low loss, assured latency, and
        limited reordering). As no DetNet specific headers are added to
        support DetNet IP flows, only the forwarding sub-layer functions are
        supported using the DetNet IP defined by this document. Service
        protection can be provided on a per sub-net
        basis using technologies such as MPLS <xref
        target="I-D.ietf-detnet-dp-sol-mpls"/> and IEEE802.1 TSN.
      </t>
    </section>

    <section title="Terminology">
      <t>
        [Editor's note: Needs clean up.].
      </t>

      <section title="Terms Used In This Document">
        <t>
          This document uses the terminology and concepts established in
          the DetNet architecture <xref
          target="I-D.ietf-detnet-architecture"/>, and the reader is assumed
          to be familiar with that document and its terminology.
        </t>
      </section>

      <section title="Abbreviations">
        <t>
          The following abbreviations used in this document:
          <!-- [JiK] Update later -->
          <list style="hanging" hangIndent="14">
            <t hangText="CE">Customer Edge equipment.</t>
            <t hangText="CoS">Class of Service.</t>
            <t hangText="DetNet">Deterministic Networking.</t>
            <t hangText="DF">DetNet Flow.</t>
            <t hangText="L2">Layer-2.</t>
            <t hangText="L3">Layer-3.</t>
            <t hangText="LSP">Label-switched path.</t>
            <t hangText="MPLS">Multiprotocol Label Switching.</t>
            <t hangText="OAM">Operations, Administration, and Maintenance.</t>
            <t hangText="PE">Provider Edge.</t>
            <t hangText="PREOF">Packet Replication, Ordering and Elimination Function.</t>
            <t hangText="PSN">Packet Switched Network.</t>
            <t hangText="PW">Pseudowire.</t>
            <t hangText="QoS">Quality of Service.</t>
            <t hangText="TE">Traffic Engineering.</t>
            <t hangText="TSN">Time-Sensitive Networking, TSN is a Task Group of the IEEE
            802.1 Working Group.</t>
          </list>
        </t>
      </section>
</section>

<section title="Requirements Language">
      <t>
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
        NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
        "MAY", and "OPTIONAL" in this document are to be interpreted as
        described in BCP 14 <xref target="RFC2119"/> <xref
        target="RFC8174"/> when, and only when, they appear in all
        capitals, as shown here.
      </t>
</section>


    <section title="DetNet IP Data Plane Overview" anchor="sec_dt_dp">
      <t>
        [Editor's note: simplify this section and highlight 
		DetNet IP over subnets scenario being the focus in 
		the remaining part of the document.].
      </t>

      <t>
        This document describes how IP is used by DetNet nodes, i.e.,
        hosts and routers, to identify DetNet flows and provide a DetNet
        service. From a data plane perspective, an end-to-end IP model
        is followed.  As mentioned above, existing IP and higher layer
        protocol header information is used to support flow
        identification and DetNet service delivery.
      </t>
      <t>
        DetNet uses "6-tuple" based flow identification, where "6-tuple"
        refers to information carried in IP and higher layer protocol
        headers. General background on the use of IP headers, and
        "5-tuples", to identify flows and support Quality of Service
        (QoS) can be found in <xref target="RFC3670"/>.  <xref
        target="RFC7657"/> also provides useful background on the
        delivery differentiated services (DiffServ) and "6-tuple" based
        flow identification.
      </t>
      <t>
        DetNet flow aggregation may be enabled via the use of
        wildcards, masks, prefixes and ranges. IP tunnels may also be
        used to support flow aggregation. In these cases, it is
        expected that DetNet aware intermediate nodes will provide
        DetNet service assurance on the aggregate through resource
        allocation and congestion control mechanisms.
      </t>
      <figure align="center" anchor="fig_ip_detnet_simple"
              title="A Simple DetNet (DN) Enabled IP Network">
        <artwork><![CDATA[
 DetNet IP       Relay                        Relay       DetNet IP
 End System      Node                         Node        End System

+----------+                                             +----------+
|   Appl.  |<------------ End to End Service ----------->|   Appl.  |
+----------+  ............                 ...........   +----------+
| Service  |<-: Service  :-- DetNet flow --: Service  :->| Service  |
+----------+  +----------+                 +----------+  +----------+
|Forwarding|  |Forwarding|                 |Forwarding|  |Forwarding|
+--------.-+  +-.------.-+                 +-.---.----+  +-------.--+
         : Link :       \      ,-----.      /     \   ,-----.   /
         +......+        +----[  Sub  ]----+       +-[  Sub  ]-+
                              [Network]              [Network]
                               `-----'                `-----'

         |<--------------------- DetNet IP --------------------->|
                         ]]></artwork>
      </figure>
      <t>
        <xref target="fig_ip_detnet_simple"/> illustrates a DetNet enabled IP
        network.  The DetNet enabled end systems originate IP encapsulated
        traffic that is identified as DetNet flows, relay nodes understand the
        forwarding requirements of the DetNet flow and ensure that node,
        interface and sub-network resources are allocated to ensure DetNet
        service requirements. The dotted line around the Service component of
        the Relay Nodes indicates that the transit routers are DetNet service
        aware but do not perform any DetNet service sub-layer function, e.g., PREOF.
        IEEE 802.1 TSN is an example sub-network type which can provide support
        for DetNet flows and service.  The mapping of DetNet IP flows to TSN
        streams and TSN protection mechanisms is covered in <xref
        target="mapping-tsn"/>.
      </t>
      <t>
        Note: The sub-network can represent a TSN, MPLS or IP network
        segment.
      </t>

      <figure align="center" anchor="fig_ip_detnet"
              title="DetNet IP Over DetNet MPLS Network">
        <artwork><![CDATA[
 DetNet IP       Relay         Transit         Relay       DetNet IP
 End System      Node           Node           Node        End System

+----------+                                              +----------+
|   Appl.  |<-------------- End to End Service ---------->|   Appl.  |
+----------+   .....-----+                  +-----.....   +----------+
| Service  |<--: Service |-- DetNet flow ---| Service :-->| Service  |
|          |   :         |<- DN MPLS flow ->|         :   |          |
+----------+   +---------+   +----------+   +---------+   +----------+
|Forwarding|   |Fwd| |Fwd|   |Forwarding|   |Fwd| |Fwd|   |Forwarding|
+--------.-+   +-.-+ +-.-+   +---.----.-+   +-.-+ +-.-+   +----.-----+
         :  Link :    /  ,-----.  \   :  Link :    /  ,-----.  \
         +.......+    +-[  Sub  ]-+   +.......+   +--[  Sub  ]--+
                        [Network]                    [Network]
                         `-----'                      `-----'

                       |<---- DetNet MPLS --->|
         |<--------------------- DetNet IP ------------------->|
                         ]]></artwork>
      </figure>
      <t>
        <xref target="fig_ip_detnet"/> illustrates a variant of <xref
        target="fig_ip_detnet_simple"/>, with an MPLS based DetNet
        network as a sub-network between the relay nodes.  It shows a
        more complex DetNet enabled IP network where an IP flow is
        mapped to one or more PWs and MPLS (TE) LSPs.  The end systems
        still originate IP encapsulated traffic that is identified as
        DetNet flows.  The relay nodes follow procedures defined in
        RRR <!-- <xref target="ip-over-mpls"/> --> to map each DetNet
        flow to MPLS LSPs. While not shown, relay nodes can provide
        service sub-layer functions such as PREOF using DetNet over MPLS,
        and this is indicated by the solid line for the MPLS
        facing portion of the Service component. Note that the Transit
        node is MPLS (TE) LSP aware and performs switching based on MPLS
        labels, and need not have any specific knowledge of the DetNet
        service or the corresponding DetNet flow identification. See
        RRR <!-- <xref target="ip-over-mpls"/> --> for details on the mapping of IP
        flows to MPLS, and <xref target="I-D.ietf-detnet-dp-sol-mpls"/>
        for general support of DetNet services using MPLS.
      </t>
      <figure align="center" anchor="fig_non_detnet_ip"
              title="Non-DetNet aware IP end systems with DetNet IP Domain">
        <artwork><![CDATA[
 IP              Edge                         Edge         IP
 End System      Node                         Node         End System

+----------+   +.........+                  +.........+   +----------+
|   Appl.  |<--:Svc Proxy:-- E2E Service ---:Svc Proxy:-->|   Appl.  |
+----------+   +.........+                  +.........+   +----------+
|    IP    |<--:IP : :Svc:----- IP flow ----:Svc: :IP :-->|    IP    |
+----------+   +---+ +---+                  +---+ +---+   +----------+
|Forwarding|   |Fwd| |Fwd|                  |Fwd| |Fwd|   |Forwarding|
+--------.-+   +-.-+ +-.-+                  +-.-+ +-.-+   +---.------+
         :  Link :      \       ,-----.      /     /  ,-----.  \
         +.......+       +-----[  Sub  ]----+     +--[  Sub  ]--+
                               [Network]             [Network]
                                `-----'               `-----'

      |<--- IP --->| |<------ DetNet IP ------->| |<--- IP --->|
                         ]]></artwork>
      </figure>
      <t>
        <xref target="fig_non_detnet_ip"/> illustrates another variant of <xref
        target="fig_ip_detnet_simple"/> where the end systems are not DetNet
        aware.  In this case, edge nodes sit at the boundary of the DetNet
        domain and provide DetNet service proxies for the end applications by
        initiating and terminating DetNet service for the application's IP
        flows.  The existing header information or an approach used for 
		aggregation can be used to support DetNet flow identification.
      </t>
      <t>
        Non-DetNet and DetNet IP packets are identical on the wire. From
        data plane perspective, the only difference is that there is
        flow-associated DetNet information on each DetNet node that
        defines the flow related characteristics and required forwarding
        behavior.  As shown above, edge nodes provide a Service Proxy
        function that "associates" one or more IP flows with the
        appropriate DetNet flow-specific information and ensures that
        the receives the proper traffic treatment within the domain.
      </t>
      <t>
        Note: The operation of IEEE802.1 TSN end systems over DetNet
        enabled IP networks is not described in this document.  While
        TSN flows could be encapsulated in IP packets by an IP End
        System or DetNet Edge Node in order to produce DetNet IP flows,
        the details of such are out of scope of this document.
      </t>

    </section>

    <!-- ===================================================================== -->



    <section title="DetNet IP Data Plane Considerations" anchor="dn-gen-encap-solution">
      <t>
        [Editor's note: Sort out what data plane considerations are relevant 
		for sub-net scenarios.].
      </t>

        <section title="DetNet Routers" anchor="detrouting">

          <t>
            Within a DetNet domain, the DetNet enabled IP Routers
            interconnect links and sub-networks to support end-to-end
            delivery of DetNet flows.  From a DetNet architecture
            perspective, these routers are DetNet relays, as they must
            be DetNet service aware.  Such routers identify DetNet flows
            based on the IP 6-tuple, and ensure that the DetNet service
            required traffic treatment is provided both on the node and
            on any attached sub-network.
          </t>
          <t>
            This solution provides DetNet functions end to end, but does so on
            a per link and sub-network basis.  Congestion protection and
            latency control and the resource allocation (queuing, policing,
            shaping) are supported using the underlying link / sub net
            specific mechanisms.  However, service protections (packet
            replication and packet elimination functions) are not provided at
            the DetNet layer end to end.  But such service protection can be
            provided on a per underlying L2 link and sub-network basis.
          </t>

            <figure title="Encapsulation of DetNet Routing in simplified IP service L3 end-systems"
                    anchor="fig_simple_iprouting">
              <artwork align="center"><![CDATA[
           +------+                         +------+
           |  X   |                         |  X   |
           +======+                         +------+
End-system |  IP  |                         |  IP  |
      -----+------+-------+======+---     --+======+--
DetNet                    |L2/SbN|          |L2/SbN|
                          +------+          +------+
                          ]]>
            </artwork></figure>

            <t>
              The DetNet Service Flow is mapped to the link / sub-network
              specific resources using an underlying system specific
              means. This implies each DetNet aware node on path looks
              into the forwarded DetNet Service Flow packet and utilize
              e.g., a 5- (or 6-) tuple to find out the required mapping within
              a node.
            </t>
            <t>
              As noted earlier, the Service Protection is done within each
              link / sub-network independently using the domain specific
              mechanisms (due the lack of a unified end to end sequencing
              information that would be available for intermediate nodes).
              Therefore, service protection (if any) cannot be provided
              end-to-end, only within sub-networks. This is shown for a three
              sub-network scenario in <xref target="fig_pref_in_subnets"/>,
              where each sub-network can provide service protection between
              its borders.
            </t>

            <figure title="Replication and elimination in sub-networks for DetNet IP networks" anchor="fig_pref_in_subnets">
              <artwork align="center">
<![CDATA[
                                 ______
                       ____     /      \__
            ____      /     \__/          \___   ______
+----+   __/    +====+                       +==+      \     +----+
|src |__/ SubN1  )   |                       |  \ SubN3 \____| dst|
+----+  \_______/    \       Sub-Network2    |   \______/    +----+
                      \_                    _/
                        \         __     __/
                         \_______/  \___/


          +---+        +---------E--------+      +-----+
+----+    |   |        |         |        |      |     |      +----+
|src |----R   E--------R     +---+        E------R     E------+ dst|
+----+    |   |        |     |            |      |     |      +----+
          +---+        +-----R------------+      +-----+
]]>
            </artwork></figure>
            <t>
              If end to end service protection is desired that can be
              implemented, for example, by the DetNet end systems using
              Layer-4 (L4) transport protocols or application
              protocols. However, these are out of scope of this document.
            </t>
        </section>
 

        <section title="Networks With Multiple Technology Segments" anchor="nwsegments">
          <!-- alternate title:
               "Mapping DetNet IP Flows to Sub-Networks and Links">
          -->
          <t>
            There are network scenarios, where the DetNet domain contains
            multiple technology segments (IEEE 802.1 TSN, MPLS) and all those
            segments are under the same administrative control (see <xref
            target="fig_pref_xcrs_segments"/>). Furthermore, DetNet nodes may be
            interconnected via TSN segments.
          </t>
          <t>
            DetNet routers ensure that detnet service requirements are
            met per hop by allocating local resources, both receive and
            transmit, and by mapping the service requirements of each
            flow to appropriate sub-network mechanisms.  Such mapping is
            sub-network technology specific.  The mapping of DetNet IP
            Flows to MPLS is covered RRR <!-- <xref
            target="ip-over-mpls"/> -->.  The mapping of IP
            DetNet Flows to IEEE 802.1 TSN is covered in <xref
            target="mapping-tsn"/>.
          </t>

          <figure title="DetNet domains and multiple technology segments" anchor="fig_pref_xcrs_segments">
            <artwork align="center"><![CDATA[
                                   ______
                         _____    /      \__
            ____        /     \__/          \___    ______
+----+   __/    +======+                        +==+      \   +----+
|src |__/  Seg1  )     |                        |  \  Seg3 \__| dst|
+----+  \_______+      \        Segment-2       |   \+_____/  +----+
                 \======+__                    _+===/
                           \         __     __/
                            \_______/  \___/
                            ]]>
          </artwork></figure>

        </section>

</section>




    <!--
         =====================================================================
         -->

    <section anchor="mapping-tsn" title="Mapping DetNet IP Flows to IEEE 802.1 TSN">
      <t>
        [Authors note: how do we handle control protocols such as
         ICMP, IPsec, etc.]
      </t>
      <t>
        This section covers how DetNet IP flows operate over an IEEE 802.1 TSN
        sub-network.  <xref target="fig_ip_detnet_to_tsn"/> illustrates such a
        scenario, where two IP (DetNet) nodes are interconnected by a TSN
        sub-network. Node-1 is single homed and Node-2 is dual-homed.  IP
        nodes can be (1) DetNet IP End System, (2) DetNet IP Edge or Relay
        node or (3) IP End System.
      </t>

<figure align="center" anchor="fig_ip_detnet_to_tsn"
              title="DetNet (DN) Enabled IP Network over a TSN sub-network">
<artwork><![CDATA[
    IP (DetNet)                   IP (DetNet)
      Node-1                        Node-2

   ............                  ............
<--: Service  :-- DetNet flow ---: Service  :-->
   +----------+                  +----------+
   |Forwarding|                  |Forwarding|
   +--------.-+    <-TSN Str->   +-.-----.--+
             \      ,-------.     /     /
              +----[ TSN-Sub ]---+     /
                   [ Network ]--------+
                    `-------'
<----------------- DetNet IP ----------------->
]]></artwork>
      </figure>

      <t>
        The Time-Sensitive Networking (TSN) Task Group of the IEEE 802.1
        Working Group have defined (and are defining) a number of
        amendments to <xref target="IEEE8021Q">IEEE 802.1Q</xref> that
        provide zero congestion loss and bounded latency in bridged
        networks. Furthermore <xref target="IEEE8021CB">IEEE
        802.1CB</xref> defines frame replication and elimination
        functions for reliability that should prove both compatible with
        and useful to, DetNet networks.  All these functions have to
        identify flows those require TSN treatment.  </t><t> As is the
        case for DetNet, a Layer 2 network node such as a bridge may
        need to identify the specific DetNet flow to which a packet
        belongs in order to provide the TSN/DetNet QoS for that packet.
        It also may need additional marking, such as the priority field
        of an IEEE Std 802.1Q VLAN tag, to give the packet proper
        service.
      </t>
          <t>
            TSN capabilities of the TSN sub-network are made available for IP
            (DetNet) flows via the protocol interworking function defined in
            <xref target="IEEE8021CB">IEEE 802.1CB</xref>. For example,
            applied on the TSN edge port connected to the IP (DetNet) node it
            can convert an ingress unicast IP (DetNet) flow to use a specific
            multicast destination MAC address and VLAN, in order to direct the
            packet through a specific path inside the bridged network. A
            similar interworking pair at the other end of the TSN sub-network
            would restore the packet to its original destination MAC address
            and VLAN.
          </t>
          <t>
            Placement of TSN functions depends on the TSN capabilities of
            nodes. IP (DetNet) Nodes may or may not support TSN functions. For
            a given TSN Stream (i.e., DetNet flow) an IP (DetNet) node is
            treated as a Talker or a Listener inside the TSN sub-network.
          </t>

          <section title="TSN Stream ID Mapping">
            <t>
              DetNet IP Flow and TSN Stream mapping is based on the active
              Stream Identification function, that operates at the frame
              level. <xref target="IEEE8021CB">IEEE 802.1CB</xref> defines an
              Active Destination MAC and VLAN Stream identification function,
              what can replace some Ethernet header fields namely (1) the
              destination MAC-address, (2) the VLAN-ID and (3) priority
              parameters with alternate values. Replacement is provided for
              the frame passed down the stack from the upper layers or up the
              stack from the lower layers.
            </t>
            <t>
              Active Destination MAC and VLAN Stream identification can be
              used within a Talker to set flow identity or a Listener to
              recover the original addressing information. It can be used also
              in a TSN bridge that is providing translation as a proxy service
              for an End System. As a result IP (DetNet) flows can be mapped
              to use a particular {MAC-address, VLAN} pair to match the Stream
              in the TSN sub-network.
            </t>
            <t>
              From the TSN sub-network perspective DetNet IP nodes without any
              TSN functions can be treated as TSN-unaware Talker or Listener.
              In such cases relay nodes in the TSN sub-network MUST modify the
              Ethernet encapsulation of the DetNet IP flow (e.g., MAC
              translation, VLAN-ID setting, Sequence number addition, etc.) to
              allow proper TSN specific handling of the flow inside the
              sub-network. This is illustrated in <xref
              target="fig_ip_without_tsn"/>.
            </t>

            <figure align="center" anchor="fig_ip_without_tsn"
                    title="IP (DetNet) node without TSN functions">
              <artwork><![CDATA[
     IP (DetNet)
       Node-1
   <---------->

   ............
<--: Service  :-- DetNet flow ------------------
   +----------+
   |Forwarding|
   +----------+    +---------------+
   |    L2    |    | L2 Relay with |<--- TSN ----
   |          |    | TSN function  |    Stream
   +-----.----+    +--.---------.--+
          \__________/           \______

    TSN-unaware
     Talker /          TSN-Bridge
     Listener             Relay
                 <-------- TSN sub-network -------
]]></artwork>
            </figure>

            <t>
              IP (DetNet) nodes being TSN-aware can be treated as a
              combination of a TSN-unaware Talker/Listener and a TSN-Relay, as
              shown in <xref target="fig_ip_with_tsn"/>.  In such cases the IP
              (DetNet) node MUST provide the TSN sub-network specific Ethernet
              encapsulation over the link(s) towards the sub-network. An
              TSN-aware IP (DetNet) node MUST support the following TSN
              components:
              <list style="numbers">
                <t>
                  For recognizing flows:
                  <list style="symbols">
                    <t>Stream Identification</t>
                  </list>
                </t>
                <t>
                  For FRER used inside the TSN domain, additionally:
                  <list style="symbols">
                    <t>Sequencing function</t>
                    <t>Sequence encode/decode function</t>
                  </list>
                </t>
                <t>
                  For FRER when the node is a replication or elimination point, additionally:
                  <list style="symbols">
                    <t>Stream splitting function</t>
                    <t>Individual recovery function</t>
                  </list>
                </t>
              </list>
            </t>

            <t>
              [Editor's note: Should we added here requirements regarding IEEE 802.1Q C-VLAN component?]
            </t>

            <figure align="center" anchor="fig_ip_with_tsn"
                    title="IP (DetNet) node with TSN functions">
              <artwork><![CDATA[
               IP (DetNet)
                  Node-2
   <---------------------------------->

   ............
<--: Service  :-- DetNet flow ------------------
   +----------+
   |Forwarding|
   +----------+    +---------------+
   |    L2    |    | L2 Relay with |<--- TSN ---
   |          |    | TSN function  |    Stream
   +-----.----+    +--.------.---.-+
          \__________/        \   \______
                               \_________
    TSN-unaware
     Talker /          TSN-Bridge
     Listener             Relay
                                       <----- TSN Sub-network -----
   <------- TSN-aware Tlk/Lstn ------->
]]></artwork>
            </figure>

            <t>
              A Stream identification component MUST be able to instantiate
              the following functions (1) Active Destination MAC and VLAN
              Stream identification function, (2) IP Stream identification
              function and (3) the related managed objects in Clause 9 of
              <xref target="IEEE8021CB">IEEE 802.1CB</xref>.  IP Stream
              identification function provides a 6-tuple match.
            </t>
            <t>
              The Sequence encode/decode function MUST support the Redundancy
              tag (R-TAG) format as per Clause 7.8 of <xref
              target="IEEE8021CB">IEEE 802.1CB</xref>.
            </t>
          </section>
          <section title="TSN Usage of FRER">
            <t>
              TSN Streams supporting DetNet flows may use Frame Replication
              and Elimination for Redundancy (FRER) [802.1CB] based on the
              loss service requirements of the TSN Stream, which is derived
              from the DetNet service requirements of the DetNet mapped flow.
              The specific operation of FRER is not modified by the use of
              DetNet and follows <xref target="IEEE8021CB">IEEE
              802.1CB</xref>.
            </t>
            <t>
              FRER function and the provided service recovery is available
              only within the TSN sub-network (as shown in <xref
              target="fig_pref_in_subnets"/>) as the Stream-ID and the TSN
              sequence number are not valid outside the sub-network.  An IP
              (DetNet) node represents a L3 border and as such it terminates
              all related information elements encoded in the L2 frames.
            </t>
          </section>
          <section title="Procedures">
            <t>
              [Editor's note: This section is TBD - covers required
              behavior of a TSN-aware DetNet node using a TSN underlay.]
            </t>
            <t>
	      This section provides DetNet IP data plane procedures to
	      interwork with a TSN underlay sub-network when the IP
	      (DetNet) node acts as a TSN-aware Talker or Listener (see
	      <xref target="fig_ip_with_tsn"/>). These procedures have
	      been divided into the following areas: flow
	      identification, mapping of a DetNet flow to a TSN Stream
	      and ensure proper TSN encapsulation.
            </t>
            <t>
	      Flow identification procedures are described in RRR <!-- <xref
	      target="ip-flow-id"/> -->.  A TSN-aware IP (DetNet) node SHALL
	      support the Stream Identification TSN components as per
	      <xref target="IEEE8021CB">IEEE 802.1CB</xref>.
            </t>
            <t>
	      Implementations of this document SHALL use management and
	      control information to map a DetNet flow to a TSN
	      Stream. N:1 mapping (aggregating DetNet flows in a single
	      TSN Stream) SHALL be supported. The management or control
	      function that provisions flow mapping SHALL ensure that
	      adequate resources are allocated and configured to provide
	      proper service requirements of the mapped flows.
            </t>
            <t>
	      For proper TSN encapsulation implementations of this
	      document SHALL support active Stream Identification
	      function as defined in chapter 6.6 in <xref
	      target="IEEE8021CB">IEEE 802.1CB</xref>.
            </t>
            <t>
	      A TSN-aware IP (DetNet) node SHALL support Ethernet
	      encapsulation with Redundancy tag (R-TAG) as per chapter
	      7.8 in <xref target="IEEE8021CB">IEEE 802.1CB</xref>.
            </t>
            <t>
	      Depending whether FRER functions are used in the TSN
	      sub-network to serve the mapped TSN Stream, a TSN-aware IP
	      (DetNet) node SHALL support Sequencing function and
	      Sequence encode/decode function as per chapter 7.4 and 7.6
	      in <xref target="IEEE8021CB">IEEE
	      802.1CB</xref>. Furthermore when a TSN-aware IP (DetNet)
	      node acting as a replication or elimination point for FRER
	      it SHALL implement the Stream splitting function and the
	      Individual recovery function as per chapter 7.7 and 7.5 in
	      <xref target="IEEE8021CB">IEEE 802.1CB</xref>.
            </t>
          </section>
</section>

<section title="Management and Control Implications">
            <t>
              [Editor's note: This section is TBD
              Covers Creation, mapping, removal of TSN Stream IDs, related
              parameters and,when needed, configuration of FRER. Supported
              by management/control plane.]
            </t>
            <t>
	      DetNet flow and TSN Stream mapping related information are
	      required only for TSN-aware IP (DetNet) nodes. From the
	      Data Plane perspective there is no practical difference
	      based on the origin of flow mapping related information
	      (management plane or control plane).
            </t>
            <t>
	      TSN-aware DetNet IP nodes are member of both the DetNet
	      domain and the TSN sub-network.  Within the TSN
	      sub-network the TSN-aware IP (DetNet) node has a TSM-aware
	      Talker/Listener role, so TSN specific management and
	      control plane functionalities must be implemented.  There
	      are many similarities in the management plane techniques
	      used in DetNet and TSN, but that is not the case for the
	      control plane protocols. For example, RSVP-TE and MSRP
	      behaves differently. Therefore management and control
	      plane design is an important aspect of scenarios, where
	      mapping between DetNet and TSN is required.
	    </t>
	    <t>
	      In order to use a TSN sub-network between DetNet nodes,
	      DetNet specific information must be converted to TSN
	      sub-network specific ones. DetNet flow ID and flow related
	      parameters/requirements must be converted to a TSN Stream
	      ID and stream related parameters/requirements. Note that,
	      as the TSN sub-network is just a portion of the end2end
	      DetNet path (i.e., single hop from IP perspective), some
	      parameters (e.g., delay) may differ significantly. Other
	      parameters (like bandwidth) also may have to be tuned due
	      to the L2 encapsulation used in the TSN sub-network.
	    </t>
	    <t>
	      In some case it may be challenging to determine some TSN
	      Stream related information. For example on a TSN-aware IP
	      (DetNet) node that acts as a Talker, it is quite obvious
	      which DetNet node is the Listener of the mapped TSN stream
	      (i.e., the IP Next-Hop). However it may be not trivial to
	      locate the point/interface where that Listener is
	      connected to the TSN sub-network. Such attributes may
	      require interaction between control and management plane
	      functions and between DetNet and TSN domains.
	    </t>
            <t>
	      Mapping between DetNet flow identifiers and TSN Stream
	      identifiers, if not provided explicitly, can be done by a
	      TSN-aware IP (DetNet) node locally based on information
	      provided for configuration of the TSN Stream
	      identification functions (IP Stream identification and
	      active Stream identification function).
	    </t>
	    <t>
	      Triggering the setup/modification of a TSN Stream in the
	      TSN sub-network is an example where management and/or
	      control plane interactions are required between the DetNet
	      and TSN sub-network. TSN-unaware IP (DetNet) nodes make
	      such a triggering even more complicated as they are fully
	      unaware of the sub-network and run independently.
	    </t>
	    <t>
	      Configuration of TSN specific functions (e.g., FRER)
	      inside the TSN sub-network is a TSN specific decision and
	      may not be visible in the DetNet domain.
	    </t>
</section>


    <!-- ===================================================================== -->

    <section title="Security Considerations">
      <t>
        The security considerations of DetNet in general are discussed in
        <xref target="I-D.ietf-detnet-architecture"/>
        and <xref target="I-D.ietf-detnet-security"/>. Other security
        considerations will be added in a future version of
        this draft.
      </t>
    </section>


    <section anchor="iana" title="IANA Considerations">
      <t>
TBD.
      </t>
    </section>

    <section anchor="acks" title="Acknowledgements">
      <t>
        Thanks for Norman Finn and Lou Berger for their comments and contributions.
      </t>
    </section>
  </middle>

  <back>
    <references title="Normative references">
      <?rfc include="reference.RFC.0768"?>
      <?rfc include="reference.RFC.0791"?>
      <?rfc include="reference.RFC.0793"?>
      <?rfc include="reference.RFC.1812"?>
      <?rfc include="reference.RFC.2119"?>
      <?rfc include="reference.RFC.2211"?>
      <?rfc include="reference.RFC.2212"?>
      <?rfc include="reference.RFC.2474"?>
      <?rfc include="reference.RFC.3168"?>
      <?rfc include="reference.RFC.3209"?>
      <?rfc include="reference.RFC.3270"?>
      <?rfc include="reference.RFC.3473"?>
      <?rfc include="reference.RFC.4302"?>
      <?rfc include="reference.RFC.4303"?>
      <?rfc include="reference.RFC.5462"?>
      <?rfc include="reference.RFC.6003"?>
      <?rfc include="reference.RFC.7608"?>
      <?rfc include="reference.RFC.8174"?>
      <?rfc include="reference.RFC.8200"?>
    </references>
    <references title="Informative references">
      <?rfc include="reference.RFC.1122"?>
      <?rfc include="reference.RFC.2205"?>
      <?rfc include="reference.RFC.2386"?>
      <?rfc include="reference.RFC.3670"?>
      <?rfc include="reference.RFC.5575"?>
      <?rfc include="reference.RFC.5777"?>
      <?rfc include="reference.RFC.5654"?>
      <?rfc include="reference.RFC.6434"?>
      <?rfc include="reference.RFC.7551"?>
      <?rfc include="reference.RFC.7657"?>
      <?rfc include="reference.RFC.7950"?>
      <?rfc include="reference.RFC.8040"?>
      <?rfc include="reference.RFC.8169"?>
      <?rfc include="reference.RFC.8283"?>
      <?rfc include="reference.I-D.ietf-detnet-architecture"?>
      <?rfc include="reference.I-D.ietf-detnet-dp-sol-mpls"?>
      <?rfc include="reference.I-D.ietf-detnet-flow-information-model"?>
      <?rfc include="reference.I-D.ietf-detnet-security"?>
      <?rfc include="reference.I-D.ietf-teas-pce-native-ip"?>

      <reference anchor='IEEE1588'>
        <front>
          <title>IEEE 1588 Standard for a Precision Clock Synchronization
          Protocol for Networked Measurement and Control Systems Version 2
          </title>
          <author>
            <organization>IEEE</organization>
          </author>
          <date year='2008' />
        </front>
      </reference>

      <reference anchor="IEEE8021Q"
                 target="http://standards.ieee.org/about/get/">
        <front>
          <title>Standard for Local and metropolitan area networks--Bridges
          and Bridged Networks (IEEE Std 802.1Q-2014)</title>
          <author>
            <organization>IEEE 802.1</organization>
          </author>
          <date year="2014"/>
        </front>
        <format type="PDF" target="http://standards.ieee.org/about/get/"/>
      </reference>

      <reference anchor="IEEE8021CB"
                 target="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf">
        <front>
          <title>Draft Standard for Local and metropolitan area networks -
          Seamless Redundancy</title>
          <author initials="N. F." surname="Finn" fullname="Norman Finn">
            <organization>IEEE 802.1</organization>
          </author>
          <date month="December" year="2015"/>
        </front>
        <seriesInfo name="IEEE P802.1CB /D2.1" value="P802.1CB"/>
        <format type="PDF" target="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf"/>
      </reference>

      <reference anchor="G.8275.1"
                 target="https://www.itu.int/rec/T-REC-G.8275.1/en">
        <front>
          <title>Precision time protocol telecom profile for phase/time
          synchronization with full timing support from the network</title>
          <author>
            <organization>International Telecommunication Union</organization>
          </author>
          <date month="June" year="2016"/>
        </front>
        <seriesInfo name="ITU-T G.8275.1/Y.1369.1" value="G.8275.1"/>
      </reference>

      <reference anchor="G.8275.2"
                 target="https://www.itu.int/rec/T-REC-G.8275.2/en">
        <front>
          <title>Precision time protocol telecom profile for phase/time
          synchronization with partial timing support from the network</title>
          <author>
            <organization>International Telecommunication Union</organization>
          </author>
          <date month="June" year="2016"/>
        </front>
        <seriesInfo name="ITU-T G.8275.2/Y.1369.2" value="G.8275.2"/>
      </reference>

    </references>

  </back>
</rfc>
