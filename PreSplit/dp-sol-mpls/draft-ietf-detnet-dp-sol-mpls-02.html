<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>DetNet MPLS Data Plane Encapsulation</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Terms Used in This Document">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Abbreviations">
<link href="#rfc.section.3" rel="Chapter" title="3 Requirements Language">
<link href="#rfc.section.4" rel="Chapter" title="4 DetNet MPLS Data Plane Overview">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Layers of DetNet Data Plane">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 DetNet MPLS Data Plane Scenarios">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 IP Over DetNet MPLS Data Plane Scenarios">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 IEEE 802.1 TSN Over DetNet MPLS Data Plane Scenario">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Packet Flow Example with Service Protection">
<link href="#rfc.section.5" rel="Chapter" title="5 DetNet MPLS Data Plane Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 End-System Specific Considerations">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Sub-Network Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 MPLS-Based DetNet Data Plane Solution">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 DetNet Over MPLS Encapsulation Components">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 MPLS Data Plane Encapsulation">
<link href="#rfc.section.6.2.1" rel="Chapter" title="6.2.1 DetNet Control Word and the DetNet Sequence Number">
<link href="#rfc.section.6.2.2" rel="Chapter" title="6.2.2 S-Labels">
<link href="#rfc.section.6.2.3" rel="Chapter" title="6.2.3 F-Labels">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 OAM Indication">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Flow Aggregation">
<link href="#rfc.section.6.4.1" rel="Chapter" title="6.4.1 Aggregation at the LSP">
<link href="#rfc.section.6.4.2" rel="Chapter" title="6.4.2 Aggregating DetNet Flows as a new DetNet flow">
<link href="#rfc.section.6.4.3" rel="Chapter" title="6.4.3 Simple Aggregation at the DetNet Layer">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Service Sub-Layer Considerations">
<link href="#rfc.section.6.5.1" rel="Chapter" title="6.5.1 Edge Node Processing">
<link href="#rfc.section.6.5.2" rel="Chapter" title="6.5.2 Relay Node Processing">
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 Forwarding Sub-Layer Considerations">
<link href="#rfc.section.6.6.1" rel="Chapter" title="6.6.1 Class of Service">
<link href="#rfc.section.6.6.2" rel="Chapter" title="6.6.2 Quality of Service">
<link href="#rfc.section.6.6.3" rel="Chapter" title="6.6.3 Cross-DetNet Flow Resource Aggregation">
<link href="#rfc.section.6.6.4" rel="Chapter" title="6.6.4 Layer 2 Addressing and QoS Considerations">
<link href="#rfc.section.6.6.5" rel="Chapter" title="6.6.5 Time Synchronization">
<link href="#rfc.section.7" rel="Chapter" title="7 Controller Plane (Management and Control)                 Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 S-Label and F-Label Assignment and Distribution">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Packet Replication, Elimination, and Ordering (PREOF)">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Contention Loss and Jitter Reduction">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Bidirectional Traffic">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Flow Aggregation Control">
<link href="#rfc.section.7.6" rel="Chapter" title="7.6 DetNet                                                           Controller (Control and Management) Plane Requirements">
<link href="#rfc.section.8" rel="Chapter" title="8 DetNet MPLS Operation Over IEEE 802.1 TSN Sub-Networks">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Mapping of TSN Stream ID and Sequence Number">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 TSN Usage of FRER">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Management and Control Implications">
<link href="#rfc.section.9" rel="Chapter" title="9 DetNet MPLS Operation over DetNet                                       IP PSNs">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations">
<link href="#rfc.section.12" rel="Chapter" title="12 Contributors">
<link href="#rfc.section.13" rel="Chapter" title="13 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="14 References">
<link href="#rfc.references.1" rel="Chapter" title="14.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="14.2 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A Example of DetNet Data Plane Operation">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.12.3 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Korhonen, J., Ed. and B. Varga, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-detnet-dp-sol-mpls-02" />
  <meta name="dct.issued" scheme="ISO8601" content="2019-06" />
  <meta name="dct.abstract" content="This document specifies the Deterministic Networking data plane when operating over an MPLS Packet Switched Networks.  " />
  <meta name="description" content="This document specifies the Deterministic Networking data plane when operating over an MPLS Packet Switched Networks.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DetNet</td>
<td class="right">J. Korhonen, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right"></td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">B. Varga, Ed.</td>
</tr>
<tr>
<td class="left">Expires: September 7, 2019</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 6, 2019</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">DetNet MPLS Data Plane Encapsulation<br />
  <span class="filename">draft-ietf-detnet-dp-sol-mpls-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies the Deterministic Networking data plane when operating over an MPLS Packet Switched Networks.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 7, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2019 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Terms Used in This Document</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Abbreviations</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Requirements Language</a>
</li>
<li>4.   <a href="#rfc.section.4">DetNet MPLS Data Plane Overview</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Layers of DetNet Data Plane</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">DetNet MPLS Data Plane Scenarios</a>
</li>
<ul><li>4.2.1.   <a href="#rfc.section.4.2.1">IP Over DetNet MPLS Data Plane Scenarios</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">IEEE 802.1 TSN Over DetNet MPLS Data Plane Scenario</a>
</li>
</ul><li>4.3.   <a href="#rfc.section.4.3">Packet Flow Example with Service Protection</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">DetNet MPLS Data Plane Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">End-System Specific Considerations</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Sub-Network Considerations</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">MPLS-Based DetNet Data Plane Solution</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">DetNet Over MPLS Encapsulation Components</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">MPLS Data Plane Encapsulation</a>
</li>
<ul><li>6.2.1.   <a href="#rfc.section.6.2.1">DetNet Control Word and the DetNet Sequence Number</a>
</li>
<li>6.2.2.   <a href="#rfc.section.6.2.2">S-Labels</a>
</li>
<li>6.2.3.   <a href="#rfc.section.6.2.3">F-Labels</a>
</li>
</ul><li>6.3.   <a href="#rfc.section.6.3">OAM Indication</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Flow Aggregation</a>
</li>
<ul><li>6.4.1.   <a href="#rfc.section.6.4.1">Aggregation at the LSP</a>
</li>
<li>6.4.2.   <a href="#rfc.section.6.4.2">Aggregating DetNet Flows as a new DetNet flow</a>
</li>
<li>6.4.3.   <a href="#rfc.section.6.4.3">Simple Aggregation at the DetNet Layer</a>
</li>
</ul><li>6.5.   <a href="#rfc.section.6.5">Service Sub-Layer Considerations</a>
</li>
<ul><li>6.5.1.   <a href="#rfc.section.6.5.1">Edge Node Processing</a>
</li>
<li>6.5.2.   <a href="#rfc.section.6.5.2">Relay Node Processing</a>
</li>
</ul><li>6.6.   <a href="#rfc.section.6.6">Forwarding Sub-Layer Considerations</a>
</li>
<ul><li>6.6.1.   <a href="#rfc.section.6.6.1">Class of Service</a>
</li>
<li>6.6.2.   <a href="#rfc.section.6.6.2">Quality of Service</a>
</li>
<li>6.6.3.   <a href="#rfc.section.6.6.3">Cross-DetNet Flow Resource Aggregation</a>
</li>
<li>6.6.4.   <a href="#rfc.section.6.6.4">Layer 2 Addressing and QoS Considerations</a>
</li>
<li>6.6.5.   <a href="#rfc.section.6.6.5">Time Synchronization</a>
</li>
</ul></ul><li>7.   <a href="#rfc.section.7">Controller Plane (Management and Control)                 Considerations</a>
</li>
<ul><li>7.1.   <a href="#rfc.section.7.1">S-Label and F-Label Assignment and Distribution</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Packet Replication, Elimination, and Ordering (PREOF)</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Contention Loss and Jitter Reduction</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Bidirectional Traffic</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">Flow Aggregation Control</a>
</li>
<li>7.6.   <a href="#rfc.section.7.6">DetNet                                                           Controller (Control and Management) Plane Requirements</a>
</li>
</ul><li>8.   <a href="#rfc.section.8">DetNet MPLS Operation Over IEEE 802.1 TSN Sub-Networks</a>
</li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Mapping of TSN Stream ID and Sequence Number</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">TSN Usage of FRER</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Management and Control Implications</a>
</li>
</ul><li>9.   <a href="#rfc.section.9">DetNet MPLS Operation over DetNet                                       IP PSNs</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a>
</li>
<li>12.   <a href="#rfc.section.12">Contributors</a>
</li>
<li>13.   <a href="#rfc.section.13">Acknowledgements</a>
</li>
<li>14.   <a href="#rfc.references">References</a>
</li>
<ul><li>14.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>14.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Example of DetNet Data Plane Operation</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#sec_intro" id="sec_intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Deterministic Networking (DetNet) is a service that can be offered by a network to DetNet flows.  DetNet provides these flows with a low packet loss rates and assured maximum end-to-end delivery latency.  General background and concepts of DetNet can be found in <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>.  </p>
<p id="rfc.section.1.p.2">The DetNet Architecture decomposes the DetNet related data plane functions into two sub-layers: a service sub-layer and a forwarding sub-layer.  The service sub-layer is used to provide DetNet service protection and reordering. The forwarding sub-layer is used to provides congestion protection (low loss, assured latency, and limited reordering) leveraging MPLS Traffic Engineering mechanisms.  </p>
<p id="rfc.section.1.p.3">This document specifies the DetNet data plane operation and the on-wire encapsulation of DetNet flows over an MPLS-based Packet Switched Network (PSN). The specified encapsulation provides the building blocks to enable the DetNet service and forwarding sub-layer functions and supports flow identification as described in the DetNet Architecture.  As part of the service sub-layer functions, this document describes DetNet node data plane operation. It also describes the function and operation of the Packet Replication (PRF) Packet Elimination (PEF) and Packet Ordering (POF) functions with an MPLS data plane.  It also describes an MPLS-based DetNet forwarding sub-layer that eliminates (or reduces) contention loss  and provides bounded latency for DetNet flows.  </p>
<p id="rfc.section.1.p.4">MPLS encapsulated DetNet flows can be carried over network technologies that can provide the DetNet required level of service.  This document defines examples of such, specifically carrying DetNet MPLS flows over IEEE 802.1 TSN sub-networks, and over DetNet IP PSN.  </p>
<p id="rfc.section.1.p.5">The intent is for this document to support different traffic types being mapped over DetNet MPLS, but this is out side the scope of this document. An example of such can be found in <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>.  This document also allows for, but does not define, associated controller plane and Operations, Administration, and Maintenance (OAM) functions.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Terms Used in This Document</h1>
<p id="rfc.section.2.1.p.1">This document uses the terminology established in the DetNet architecture <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>, and the reader is assumed to be familiar with that document and its terminology.  </p>
<p id="rfc.section.2.1.p.2">The following terminology is introduced in this document: </p>

<dl>
<dt>F-Label</dt>
<dd style="margin-left: 14">A Detnet "forwarding" label that identifies the LSP used to forward a DetNet flow across an MPLS PSN, e.g., a hop-by-hop label used between label switching routers (LSR).</dd>
<dt>S-Label</dt>
<dd style="margin-left: 14">A DetNet "service" label that is used between DetNet nodes that implement also the DetNet service sub-layer functions. An S-Label is also used to identify a DetNet flow at DetNet service sub-layer.</dd>
<dt>d-CW</dt>
<dd style="margin-left: 14">A DetNet Control Word (d-CW) is used for sequencing and identifying duplicate packets of a DetNet flow at the DetNet service sub-layer. </dd>
</dl>

<p> </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Abbreviations</h1>
<p id="rfc.section.2.2.p.1">The following abbreviations are used in this document: </p>

<dl>
<dt>AC</dt>
<dd style="margin-left: 14">Attachment Circuit.</dd>
<dt>CE</dt>
<dd style="margin-left: 14">Customer Edge equipment.</dd>
<dt>CoS</dt>
<dd style="margin-left: 14">Class of Service.</dd>
<dt>CW</dt>
<dd style="margin-left: 14">Control Word.</dd>
<dt>DetNet</dt>
<dd style="margin-left: 14">Deterministic Networking.</dd>
<dt>DF</dt>
<dd style="margin-left: 14">DetNet Flow.</dd>
<dt>DN-IWF</dt>
<dd style="margin-left: 14">DetNet Inter-Working Function.</dd>
<dt>L2</dt>
<dd style="margin-left: 14">Layer 2.</dd>
<dt>L2VPN</dt>
<dd style="margin-left: 14">Layer 2 Virtual Private Network.</dd>
<dt>L3</dt>
<dd style="margin-left: 14">Layer 3.</dd>
<dt>LSR</dt>
<dd style="margin-left: 14">Label Switching Router.</dd>
<dt>MPLS</dt>
<dd style="margin-left: 14">Multiprotocol Label Switching.</dd>
<dt>MPLS-TE</dt>
<dd style="margin-left: 14">Multiprotocol Label Switching - Traffic Engineering.</dd>
<dt>MPLS-TP</dt>
<dd style="margin-left: 14">Multiprotocol Label Switching - Transport Profile.</dd>
<dt>MS-PW</dt>
<dd style="margin-left: 14">Multi-Segment PseudoWire (MS-PW).</dd>
<dt>NSP</dt>
<dd style="margin-left: 14">Native Service Processing.</dd>
<dt>OAM</dt>
<dd style="margin-left: 14">Operations, Administration, and Maintenance.</dd>
<dt>PE</dt>
<dd style="margin-left: 14">Provider Edge.</dd>
<dt>PEF</dt>
<dd style="margin-left: 14">Packet Elimination Function.</dd>
<dt>PRF</dt>
<dd style="margin-left: 14">Packet Replication Function.</dd>
<dt>PREOF</dt>
<dd style="margin-left: 14">Packet Replication, Elimination and Ordering Functions.</dd>
<dt>POF</dt>
<dd style="margin-left: 14">Packet Ordering Function.</dd>
<dt>PSN</dt>
<dd style="margin-left: 14">Packet Switched Network.</dd>
<dt>PW</dt>
<dd style="margin-left: 14">PseudoWire.</dd>
<dt>QoS</dt>
<dd style="margin-left: 14">Quality of Service.</dd>
<dt>S-PE</dt>
<dd style="margin-left: 14">Switching Provider Edge.</dd>
<dt>T-PE</dt>
<dd style="margin-left: 14">Terminating Provider Edge.</dd>
<dt>TSN</dt>
<dd style="margin-left: 14">Time-Sensitive Network.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Requirements Language</h1>
<p id="rfc.section.3.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#sec_dt_dp" id="sec_dt_dp">DetNet MPLS Data Plane Overview</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#sec_lay_dt_dp" id="sec_lay_dt_dp">Layers of DetNet Data Plane</a>
</h1>
<p id="rfc.section.4.1.p.1">This document describes how DetNet flows are carried over MPLS networks. The DetNet Architecture, <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>, decomposes the DetNet data plane into two sub-layers: a service sub-layer and a forwarding sub-layer.  The basic approach defined in this document supports the DetNet service sub-layer based on existing pseudowire (PW) encapsulations and mechanisms, and supports the DetNet forwarding sub-layer based on existing MPLS Traffic Engineering encapsulations and mechanisms.  Background on PWs can be found in <a href="#RFC3985" class="xref">[RFC3985]</a> and <a href="#RFC3031" class="xref">[RFC3031]</a>. Background on MPLS Traffic Engineering can be found in <a href="#RFC3272" class="xref">[RFC3272]</a> and <a href="#RFC3209" class="xref">[RFC3209]</a>.  </p>
<div id="rfc.figure.1"></div>
<div id="dn_mpls_dp_approach"></div>
<pre>
  DetNet        MPLS
    .
    .
+------------+
|  Service   | d-CW, S-Label
+------------+
| Forwarding | F-Label(s)
+------------+
    .
    .
</pre>
<p class="figure">Figure 1: DetNet Adaptation to MPLS Data Plane</p>
<p id="rfc.section.4.1.p.2">The DetNet MPLS data plane approach defined in this document is shown in <a href="#dn_mpls_dp_approach" class="xref">Figure 1</a>.  The service sub-layer is supported by a DetNet control word (d-CW) which conforms to the Generic PW MPLS Control Word (PWMCW) defined in <a href="#RFC4385" class="xref">[RFC4385]</a>.  A d-CW identifying service label (S-Label) is also used.  </p>
<p id="rfc.section.4.1.p.3">A node operating on a DetNet flow in the Detnet service sub-layer, i.e. a node processing a DetNet packet which has the S-Label as top of stack uses the local context associated with that S-Label, for example a received F-Label, to determine what local DetNet operation(s) are applied to that packet. An S-Label may be unique when taken from the platform label space <a href="#RFC3031" class="xref">[RFC3031]</a>, which would enable correct DetNet flow identification regardless of which input interface or LSP the packet arrives on.  </p>
<p id="rfc.section.4.1.p.4">The DetNet MPLS data plane builds on MPLS Traffic Engineering encapsulations and mechanisms to provide a forwarding sub-layer that is responsible for providing resource allocation and explicit routes.  The forwarding sub-layer is supported by one or more forwarding labels (F-Labels).  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#sec_mpls_dt_dp_scen" id="sec_mpls_dt_dp_scen">DetNet MPLS Data Plane Scenarios</a>
</h1>
<div id="rfc.figure.2"></div>
<div id="fig_dn_mpls_detnet"></div>
<pre>
DetNet MPLS       Relay       Transit         Relay       DetNet MPLS
End System        Node         Node           Node        End System
   (T-PE)        (S-PE)       (LSR)          (S-PE)         (T-PE)
+----------+                                             +----------+
|   Appl.  |&lt;------------ End to End Service -----------&gt;|   Appl.  |
+----------+   +---------+                 +---------+   +----------+
| Service  |&lt;--| Service |-- DetNet flow --| Service |--&gt;| Service  |
+----------+   +---------+  +----------+   +---------+   +----------+
|Forwarding|   |Fwd| |Fwd|  |Forwarding|   |Fwd| |Fwd|   |Forwarding|
+-------.--+   +-.-+ +-.-+  +----.---.-+   +-.-+ +-.-+   +---.------+
        :  Link  :    /  ,-----.  \   : Link :    /  ,-----.  \
        +........+    +-[  Sub  ]-+   +......+    +-[  Sub  ]-+
                        [Network]                   [Network]
                         `-----'                     `-----'
        |&lt;- LSP --&gt;| |&lt;-------- LSP -----------| |&lt;--- LSP --&gt;|

        |&lt;----------------- DetNet MPLS ---------------------&gt;|

        </pre>
<p class="figure">Figure 2: A DetNet MPLS Network</p>
<p><a href="#fig_dn_mpls_detnet" class="xref">Figure 2</a> illustrates a hypothetical DetNet MPLS-only network composed of DetNet aware MPLS enabled end systems, operating over a DetNet aware MPLS network. In this figure, relay nodes sit at MPLS LSP boundaries and transit nodes are LSRs.  </p>
<p id="rfc.section.4.2.p.2">DetNet end system and relay nodes are DetNet service sub-layer aware, understand the particular needs of DetNet flows and provide both DetNet service and forwarding sub-layer functions.  They add, remove and process d-CWs, S-Labels and F-labels as needed.  MPLS enabled end system and relay nodes can enhance the reliability of delivery by enabling the replication of packets where multiple copies, possibly over multiple paths, are forwarded through the DetNet domain.  They can also eliminate surplus previously replicated copies of DetNet packets.  DetNet MPLS nodes provide functionality similar to T-PEs when they sit at the edge of an MPLS domain, and functionality similar to S-PEs when they are in the middle of an MPLS domain, see <a href="#RFC6073" class="xref">[RFC6073]</a>.  End system and relay nodes also include DetNet forwarding sub-layer functions, support for notably explicit routes, and resources allocation to eliminate (or reduce) congestion loss and jitter.  </p>
<p id="rfc.section.4.2.p.3">DetNet transit nodes reside wholly within a DetNet domain, and also provide DetNet forwarding sub-layer functions in accordance with the performance required by a DetNet flow carried over an LSP. Unlike other DetNet node types, transit nodes provide no service sub-layer processing.  In a DetNet MPLS network, transit nodes may be DetNet service aware or may be DetNet unaware MPLS Label Switching Routers (LSRs).  In this latter case, such LSRs would be unaware of the special requirements of the DetNet service sub-layer, but would still provide traffic engineering services and the QoS need to ensure that the (TE) LSPs meet the service requirements of the carried DetNet flows.  </p>
<p id="rfc.section.4.2.p.4">The LSPs may be provided by any MPLS controller method. For example they may be provisioned via a management plane, RSVP-TE, MPLS-TP, or MPLS Segment Routing (when extended to support resource allocation).  </p>
<p><a href="#fig_pw_detnet" class="xref">Figure 3</a> illustrates how an end to end MPLS-based DetNet service is provided in a more detail.  In this figure, the end systems, CE1 and CE2, are able to send and receive MPLS encapsulated DetNet flows, and R1, R2 and R3 are relay nodes as they sit in the middle of a DetNet network. The 'X' in the end systems, and relay nodes represents potential DetNet compound flow packet replication and elimination points.  In this example, service protection is supported over four DetNet member flows and TE LSPs. For a unidirectional flow, R1 supports PRF, R2 supports PREOF and R3 supports PEF and POF.  Note that the relay nodes may change the underlying forwarding sub-layer, for example tunneling MPLS over IEEE 802.1 TSN <a href="#mpls-over-tsn" class="xref">Section 8</a>, or simply over interconnect network links.  </p>
<div id="rfc.figure.3"></div>
<div id="fig_pw_detnet"></div>
<pre>
      DetNet                                           DetNet
MPLS  Service          Transit          Transit       Service MPLS
DetNet  |             |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|            | DetNet
End     |             V   1   V        V   2   V            | End
System  |    +--------+       +--------+       +--------+   | System
+---+   |    |   R1   |=======|   R2   |=======|   R3   |   |  +---+
|  X...DFa...|._X_....|..DF1..|.__ ___.|..DF3..|...._X_.|.DFa..|.X |
|CE1|========|    \   |       |   X    |       |   /    |======|CE2|
|   |   |    |     \_.|..DF2..|._/ \__.|..DF4..|._/     |   |  |   |
+---+        |        |=======|        |=======|        |      +---+
    ^        +--------+       +--------+       +--------+      ^
    |        Relay Node       Relay Node       Relay Node      |
    |          (S-PE)           (S-PE)           (S-PE)        |
    |                                                          |
    |&lt;---------------------- DetNet MPLS ---------------------&gt;|
    |                                                          |
    |&lt;--------------- End to End DetNet Service --------------&gt;|

   -------------------------- Data Flow -------------------------&gt;

    X   = Optional service protection (none, PRF, PREOF, PEF/POF)
    DFx = DetNet member flow x over a TE LSP
</pre>
<p class="figure">Figure 3: MPLS-Based Native DetNet</p>
<p id="rfc.section.4.2.p.6">As previously mentioned, this document specifies how MPLS is used to support DetNet flows using an MPLS data plane as well as how such can be mapped to IEEE 802.1 TSN and IP DetNet PSNs.  In the remainder of this section, sample uses of DetNet MPLS are shown for illustrative purposes.  These uses are an IP DetNet, where the end nodes support <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>, and an L2VPN service, where the L2 is itself an IEEE 802.1 TSN.  </p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#sec_ip_mpls_dt_dp_scen" id="sec_ip_mpls_dt_dp_scen">IP Over DetNet MPLS Data Plane Scenarios</a>
</h1>
<p id="rfc.section.4.2.1.p.1">[Author's note: this section to be moved to IP sol draft] </p>
<div id="rfc.figure.4"></div>
<div id="fig_dn_ip_mpls_detnet"></div>
<pre>
IP  DetNet        Relay       Transit         Relay       IP DetNet
End System        Node         Node           Node        End System
                  (T-PE)       (LSR)          (T-PE)
+----------+                                             +----------+
|   Appl.  |&lt;------------ End to End Service -----------&gt;|   Appl.  |
+----------+   .....-----+                 +-----.....   +----------+
| Service  |&lt;--: Service |-- DetNet flow --| Service :--&gt;| Service  |
+----------+   +---------+  +----------+   +---------+   +----------+
|Forwarding|   |Fwd| |Fwd|  |Forwarding|   |Fwd| |Fwd|   |Forwarding|
+-------.--+   +-.-+ +-.-+  +----.---.-+   +-.-+ +-.-+   +---.------+
        :  Link  :    /  ,-----.  \   : Link :    /  ,-----.  \
        +........+    +-[  Sub  ]-+   +......+    +-[  Sub  ]-+
                        [Network]                   [Network]
                         `-----'                     `-----'

        |&lt;- DN IP-&gt;| |&lt;---- DetNet MPLS ----&gt;| |&lt; -DN IP -&gt;|
        </pre>
<p class="figure">Figure 4: DetNet IP Over MPLS Network</p>
<p><a href="#fig_dn_ip_mpls_detnet" class="xref">Figure 4</a> illustrates DetNet enabled End Systems (hosts), connected to DetNet (DN) enabled IP networks, operating over a DetNet aware MPLS network. In this figure, Relay nodes sit at the boundary of the MPLS domain since the non-MPLS domain is DetNet aware.  This figure is very similar to <a href="#fig_dn_mpls_detnet" class="xref">Figure 2</a>.  The primary difference is that the Relay nodes are at the edges of the MPLS domain and therefore function as T-PEs, and that service sub-layer functions are not provided over the DetNet IP network.  There is no difference in transit node function.  </p>
<p><a href="#fig_ip_pw_detnet" class="xref">Figure 5</a> illustrates how relay nodes can provide service protection over the MPLS domain.  In this case, CE1 and CE2 are IP DetNet end systems which are interconnected via a MPLS domain such as previously shown in <a href="#fig_pw_detnet" class="xref">Figure 3</a>.  Note that R1 and R3 sit at the edges of an MPLS domain and therefore are similar to T-PEs, while R2 sits in the middle of the domain and is therefore similar to an S-PE.  </p>
<div id="rfc.figure.5"></div>
<div id="fig_ip_pw_detnet"></div>
<pre>
      DetNet                                         DetNet
IP    Service         Transit          Transit       Service  IP
DetNet               |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|               DetNet
End     |            V   1   V        V   2   V            |  End
System  |   +--------+       +--------+       +--------+   |  System
+---+   |   |   R1   |=======|   R2   |=======|   R3   |   |   +---+
|   |-------|._X_....|..DF1..|.__ ___.|..DF3..|...._X_.|-------|   |
|CE1|   |   |    \   |       |   X    |       |   /    |   |   |CE2|
|   |   |   |     \_.|..DF2..|._/ \__.|..DF4..|._/     |   |   |   |
+---+       |        |=======|        |=======|        |       +---+
    ^       +--------+       +--------+       +--------+       ^
    |        Relay Node       Relay Node       Relay Node      |
    |          (T-PE)           (S-PE)          (T-PE)         |
    |                                                          |
    |&lt;-DN IP-&gt; &lt;-------- DetNet MPLS ---------------&gt; &lt;-DN IP-&gt;|
    |                                                          |
    |&lt;-------------- End to End DetNet Service ---------------&gt;|

   -------------------------- Data Flow -------------------------&gt;

    X   = Service protection (PRF, PREOF, PEF/POF)
    DFx = DetNet member flow x over a TE LSP
    </pre>
<p class="figure">Figure 5: DetNet IP Over DetNet MPLS Network</p>
<div id="rfc.figure.6"></div>
<div id="fig_ip_mpls_detnet"></div>
<pre>
 IP               Edge                        Edge        IP
 End System       Node                        Node        End System
                 (T-PE)       (LSR)          (T-PE)
+----------+   +....-----+                 +-----....+   +----------+
|   Appl.  |&lt;--:Svc Proxy|-- E2E Service --|Svc Proxy:--&gt;|   Appl.  |
+----------+   +.....+---+                 +---+.....+   +----------+
|    IP    |&lt;--:IP : |Svc|-- IP/DN Flow ---|Svc| :IP :--&gt;|    IP    |
+----------+   +---+ +---+  +----------+   +---+ +---+   +----------+
|Forwarding|   |Fwd| |Fwd|  |Forwarding|   |Fwd| |Fwd|   |Forwarding|
+-------.--+   +-.-+ +-.-+  +----.---.-+   +-.-+ +-.-+   +---.------+
        :  Link  :    /  ,-----.  \   : Link :    /  ,-----.  \
        +........+    +-[  Sub  ]-+   +......+    +-[  Sub  ]-+
                        [Network]                   [Network]
                         `-----'                     `-----'

      |&lt;--- IP ---&gt;| |&lt;----- DetNet MPLS -----&gt;| |&lt;--- IP ---&gt;|
      </pre>
<p class="figure">Figure 6: Non-DetNet Aware IP Over DetNet MPLS Network</p>
<p><a href="#fig_ip_mpls_detnet" class="xref">Figure 6</a> illustrates non-DetNet enabled End Systems (hosts), connected to DetNet (DN) enabled MPLS network. It differs from <a href="#fig_dn_ip_mpls_detnet" class="xref">Figure 4</a> in that the hosts and edge IP networks are not DetNet aware.  In this case, edge nodes sit at the boundary of the MPLS domain since it is also a DetNet domain boundary.  The edge nodes provide DetNet service proxies for the end applications by initiating and terminating DetNet service for the application's IP flows. See <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a> for more information.  </p>
<p><a href="#fig_pw_detnet2" class="xref">Figure 7</a> illustrates how it is still possible to provided DetNet service protection for non-DetNet aware end systems.  This figures is basically the same as <a href="#fig_ip_pw_detnet" class="xref">Figure 5</a>, with the exception that CE1 and CE2 are non-DetNet aware end systems and E1 and E3 are edge nodes that replace the relay nodes R1 and R3.  </p>
<div id="rfc.figure.7"></div>
<div id="fig_pw_detnet2"></div>
<pre>
      IP                                              IP
Non   Service          Transit          Transit       Service Non
DetNet                |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|              DetNet
End     |             V   1   V        V   2   V            | End
System  |    +--------+       +--------+       +--------+   | System
+---+   |    |   E1   |=======|   R2   |=======|   E3   |   |  +---+
|   |--------|._X_....|..DF1..|.__ ___.|..DF3..|...._X_.|------|   |
|CE1|   |    |    \   |       |   X    |       |   /    |   |  |CE2|
|   |   |    |     \_.|..DF2..|._/ \__.|..DF4..|._/     |   |  |   |
+---+        |        |=======|        |=======|        |      +---+
             +--------+       +--------+       +--------+
             ^ Edge Node      Relay Node       Edge Node^
             | (T-PE)           (S-PE)          (T-PE)  |
             |                                          |
     &lt;--IP--&gt;| &lt;-------- IP Over DetNet MPLS ---------&gt; |&lt;--IP--&gt;
             |                                          |
             |&lt;------ End to End DetNet Service -------&gt;|

    X   = Optional service protection (none, PRF, PREOF, PEF/POF)
    DFx = DetNet member flow x over a TE LSP
</pre>
<p class="figure">Figure 7: MPLS-Based DetNet (non-MPLS End System)</p>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> <a href="#sec_tsn_mpls_dt_dp_scen" id="sec_tsn_mpls_dt_dp_scen">IEEE 802.1 TSN Over DetNet MPLS Data Plane Scenario</a>
</h1>
<p id="rfc.section.4.2.2.p.1">[Author's note: this section to be moved to TSN over mpls sol draft] </p>
<div id="rfc.figure.8"></div>
<div id="fig_tsn_mpls_detnet"></div>
<pre>
 TSN             Edge          Transit        Edge        TSN
 End System      Node           Node          Node        End System
                (T-PE)         (LSR)          (T-PE)

+----------+  +.........+                   +.........+  +----------+
|   Appl.  |&lt;-:Svc Proxy:--End to End Svc.--:Svc Proxy:-&gt;|   Appl.  |
+----------+  +---------+                   +---------+  +----------+
|    TSN   |  |TSN| |Svc|&lt;-- DetNet flow --&gt;|Svc| |TSN|  |    TSN   |
+----------+  +---+ +---+    +----------+   +---+ +---+  +----------+
|Forwarding|  |Fwd| |Fwd|    |Forwarding|   |Fwd| |Fwd|  |Forwarding|
+------.---+  +--.+ +-.-+    +---.----.-+   +--.+ +-.-+  +----.-----+
       :   Link  :    /  ,-----.  \   :  Link  :   /  ,-----.  \
       +.........+    +-[  Sub  ]-+   +........+   +-[  Sub  ]-+
                        [Network]                    [Network]
                         `-----'                      `-----'

        |&lt;- TSN -&gt;| |&lt;------ DetNet MPLS ------&gt;| |&lt;-- TSN ---&gt;|
</pre>
<p class="figure">Figure 8: A TSN over DetNet MPLS Enabled Network</p>
<p><a href="#fig_tsn_mpls_detnet" class="xref">Figure 8</a> shows IEEE 802.1 TSN end stations operating over a TSN aware DetNet service running over an MPLS network.  DetNet Edge Nodes sit at the boundary of a DetNet domain. They are responsible for mapping non-DetNet aware L2 traffic to DetNet services.  They also support the imposition and disposition of the required DetNet encapsulation.  These are functionally similar to pseudowire (PW) Terminating Provider Edge (T-PE) nodes which use MPLS-TE LSPs.  In this example they understand and support IEEE 802.1 TSN and are able to map TSN flows into DetNet flows.  The specific of this operation are discussed in [TBD-TSN-OVER-DETNET].  </p>
<p id="rfc.section.4.2.2.p.3">Native TSN flow and DetNet MPLS flow differ not only by the additional MPLS specific encapsulation, but DetNet MPLS flows have on each DetNet node an associated DetNet specific data structure, what defines flow related characteristics and required forwarding functions. In this example, edge Nodes provide a service proxy function that "associates" the DetNet flows and native flows at the edge of the DetNet domain. This ensures that the DN Flow is properly served at the Edge node (and inside the domain).  </p>
<p><a href="#fig_8021_detnet" class="xref">Figure 9</a> illustrates how DetNet can provide services for IEEE 802.1TSN end systems, CE1 and CE2, over a DetNet enabled MPLS network.  Similar to <a href="#fig_ip_mpls_detnet" class="xref">Figure 6</a>, the edge nodes, E1 and E2, insert and remove required DetNet data plane encapsulation.  The 'X' in the edge nodes and relay node, R1, represent a potential DetNet compound flow packet replication and elimination point.  This conceptually parallels L2VPN services, and could leverage existing related solutions as discussed below.  </p>
<div id="rfc.figure.9"></div>
<div id="fig_8021_detnet"></div>
<pre>
     TSN    |&lt;------- End to End DetNet Service ------&gt;|  TSN
    Service |         Transit          Transit         | Service
TSN  (AC)   |        |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|        |  (AC)  TSN
End    |    V        V    1  V        V   2   V        V   |    End
System |    +--------+       +--------+       +--------+   |  System
+---+  |    |   E1   |=======|   R1   |=======|   E2   |   |   +---+
|   |--|----|._X_....|..DF1..|.._ _...|..DF3..|...._X_.|---|---|   |
|CE1|  |    |    \   |       |   X    |       |   /    |   |   |CE2|
|   |       |     \_.|..DF2..|._/ \_..|..DF4..|._/     |       |   |
+---+       |        |=======|        |=======|        |       +---+
    ^       +--------+       +--------+       +--------+       ^
    |        Edge Node       Relay Node        Edge Node       |
    |          (T-PE)           (S-PE)          (T-PE)         |
    |                                                          |
    |&lt;- TSN -&gt; &lt;------- TSN Over DetNet MPLS -------&gt; &lt;- TSN -&gt;|
    |                                                          |
    |&lt;--- Emulated Time Sensitive Networking (TSN) Service ---&gt;|

    X   = Service protection
    DFx = DetNet member flow x over a TE LSP

</pre>
<p class="figure">Figure 9: IEEE 802.1TSN Over DetNet</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Packet Flow Example with Service Protection</h1>
<p id="rfc.section.4.3.p.1">An example DetNet MPLS network fragment and packet flow is illustrated in <a href="#fig_mpls_example" class="xref">Figure 10</a>.  </p>
<div id="rfc.figure.10"></div>
<div id="fig_mpls_example"></div>
<pre>
   1      1.1       1.1      1.2.1    1.2.1      1.2.2
CE1----EN1--------R1-------R2-------R3--------EN2-----CE2
         \           1.2.1 /                   /
          \1.2     /-----+                   /
           +------R4------------------------+
                     1.2.2
 </pre>
<p class="figure">Figure 10: Example Packet Flow in DetNet Enabled MPLS Network</p>
<p id="rfc.section.4.3.p.2">In <a href="#fig_mpls_example" class="xref">Figure 10</a> the numbers are used to identify the instance of a packet. Packet 1 is the original packet, and packets 1.1, and 1.2 are two first generation copies of packet 1.  Packet 1.2.1 is a second generation copy of packet 1.2 etc.  Note that these numbers never appear in the packet, and are not to be confused with sequence numbers, labels or any other identifier that appears in the packet. They simply indicate the generation number of the original packet so that its passage through the network fragment can be identified to the reader.  </p>
<p id="rfc.section.4.3.p.3">Customer Equipment CE1 sends a packet into the DetNet enabled MPLS network. This is packet (1).  Edge Node EN1 encapsulates the packet as a DetNet Packet and sends it to Relay node R1 (packet 1.1).  EN1 makes a copy of the packet (1.2), encapsulates it and sends this copy to Relay node R4.  </p>
<p id="rfc.section.4.3.p.4">Note that along the MPLS path from EN1 to R1 there may be zero or more LSRs which, for clarity, are not shown. The same is true for any other path between two DetNet entities shown in <a href="#fig_mpls_example" class="xref">Figure 10</a>.  </p>
<p id="rfc.section.4.3.p.5">Relay node R4 has been configured to send one copy of the packet to Relay Node R2 (packet 1.2.1) and one copy to Edge Node EN2 (packet 1.2.2).  </p>
<p id="rfc.section.4.3.p.6">R2 receives packet copy 1.2.1 before packet copy 1.1 arrives, and, having been configured to perform packet elimination on this DetNet flow, forwards packet 1.2.1 to Relay Node R3.  Packet copy 1.1 is of no further use and so is discarded by R2.  </p>
<p id="rfc.section.4.3.p.7">Edge Node EN2 receives packet copy 1.2.2 from R4 before it receives packet copy 1.2.1 from R2 via relay Node R3. EN2 therefore strips any DetNet encapsulation from packet copy 1.2.2 and forwards the packet to CE2. When EN2 receives the later packet copy 1.2.1 this is discarded.  </p>
<p id="rfc.section.4.3.p.8">The above is of course illustrative of many network scenarios that can be configured.  Between a pair of relay nodes there may be one or more transit nodes that simply forward the DetNet traffic, but these are omitted for clarity.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#dn-gen-encap-solution" id="dn-gen-encap-solution">DetNet MPLS Data Plane Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This section provides informative considerations related to providing DetNet service to flows which are identified based on their header information. At a high level, the following are provided on a per flow basis: </p>

<dl>
<dt>Eliminating contention loss and jitter reduction:</dt>
<dd style="margin-left: 8">
<br><br> Use of allocated resources (queuing, policing, shaping) to ensure that the congestion-related loss and latency/jitter requirements of a DetNet flow are met.  </dd>
<dt>Explicit routes:</dt>
<dd style="margin-left: 8">
<br><br> Use of a specific path for a flow.  This limits misordering and bounds latency.  </dd>
<dt>Service protection:</dt>
<dd style="margin-left: 8">
<br><br> Which in the case of this document primarily relates to replication and elimination. Changing the explicit path after a failure is detected in order to restore delivery of the required DetNet service characteristics is also possible. Path changes, even in the case of failure recovery, can lead to the out of order delivery of data.  </dd>
<dt>Load sharing:</dt>
<dd style="margin-left: 8">
<br><br> Generally, distributing packets of the same DetNet flow over multiple paths is not recommended. Such load sharing, e.g., via ECMP or UCMP, impacts ordering and possibly jitter.  </dd>
<dt>Troubleshooting:</dt>
<dd style="margin-left: 8">
<br><br> For example, to support identification of misbehaving flows.  </dd>
<dt>Recognize flow(s) for analytics:</dt>
<dd style="margin-left: 8">
<br><br> For example, increase counters.  </dd>
<dt>Correlate events with flows:</dt>
<dd style="margin-left: 8">
<br><br> For example, unexpected loss.  </dd>
</dl>

<p> </p>
<p id="rfc.section.5.p.2">The DetNet data plane also allows for the aggregation of DetNet flows, e.g., via MPLS hierarchical LSPs, to improved scaling.  When DetNet flows are aggregated, transit nodes provide service to the aggregate and not on a per-DetNet flow basis.  In this case, nodes performing aggregation will ensure that per-flow service requirements are achieved.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> End-System Specific Considerations</h1>
<p id="rfc.section.5.1.p.1">Data-flows requiring DetNet service are generated and terminated on end-systems. Encapsulation depends on application and its preferences. In a DetNet MPLS domain the DN functions use the d-CWs, S-Labels and F-Labels to provide DetNet services. However, an application may exchange further flow related parameters (e.g., time-stamp), which are not provided by DN functions.  </p>
<p id="rfc.section.5.1.p.2">Specifics related to non-MPLS DetNet end station behavior are out side the scope of this document.  For example, details on support for DetNet IP data flows can be found in <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>. This document is also useful for end stations that map IP flows to DetNet flows.  </p>
<p id="rfc.section.5.1.p.3">As a general rule, DetNet MPLS domains are capable of forwarding any DetNet MPLS flows and the DetNet domain does not mandate the end-system or edge system encapsulation format. Unless there is a proxy of some form present, end-systems peer with similar end-systems using the same application encapsulation format.  For example, as shown in <a href="#fig_es_connect" class="xref">Figure 11</a>, IP applications peer with IP applications and Ethernet L2VPN applications peer with Ethernet L2VPN applications.  </p>
<div id="rfc.figure.11"></div>
<div id="fig_es_connect"></div>
<pre>
+-----+
|  X  |                               +-----+
+-----+                               |  X  |
| Eth |               ________        +-----+
+-----+     _____    /        \       | Eth |
       \   /     \__/          \___   +-----+
        \ /                        \ /
         0======== tunnel-1 ========0_
         |                             \
          \                             |
          0========= tunnel-2 =========0
         / \                        __/ \
  +-----+   \__ DetNet MPLS domain /     \
  |  X  |      \         __       /       +-----+
  +-----+       \_______/  \_____/        |  X  |
  |  IP |                                 +-----+
  +-----+                                 |  IP |
                                          +-----+
  
    </pre>
<p class="figure">Figure 11: End-Systems and The DetNet MPLS Domain</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Sub-Network Considerations</h1>
<p id="rfc.section.5.2.p.1">As shown in <a href="#fig_dn_mpls_detnet" class="xref">Figure 2</a>, MPLS nodes are interconnected by different sub-network technologies, which may include point-to-point links. Each of these need to provide appropriate service to DetNet flows.  In some cases, e.g., on dedicated point-to-point links or TDM technologies, all that is required is for a DetNet node to appropriately queue its output traffic.  In other cases, DetNet nodes will need to map DetNet flows to the flow semantics (i.e., identifiers) and mechanisms used by an underlying sub-network technology.  <a href="#fig_dn_mpls_sn_ex" class="xref">Figure 12</a> shows several examples of header formats that can be used to carry DetNet MPLS flows over different sub-network technologies.  L2 represent a generic layer-2 encapsulation that might be used on a point-to-point link.  TSN represents the encapsulation used on an IEEE 802.1 TSN network, as described in <a href="#mpls-over-tsn" class="xref">Section 8</a>.  UDP/IP represents the encapsulation used on a DetNet IP PSN, as described in <a href="#mpls-over-ip" class="xref">Section 9</a> .  </p>
<div id="rfc.figure.12"></div>
<div id="fig_dn_mpls_sn_ex"></div>
<pre>

                   +------+  +------+  +------+
App-Flow           |  X   |  |  X   |  |  X   |
             +-----+======+--+======+--+======+-----+
DetNet-MPLS        | d-CW |  | d-CW |  | d-CW |
                   +------+  +------+  +------+
                   |Labels|  |Labels|  |Labels|
             +-----+======+--+======+--+======+-----+
Sub-Network        |  L2  |  | TSN  |  | UDP  |
                   +------+  +------+  +------+
                                       |  IP  |
                                       +------+
                                       |  L2  |
                                       +------+
    
  </pre>
<p class="figure">Figure 12: Example DetNet MPLS Sub-Network Formats</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#dn-dt-solution" id="dn-dt-solution">MPLS-Based DetNet Data Plane Solution</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#dn-MPLS-en-comps" id="dn-MPLS-en-comps">DetNet Over MPLS Encapsulation Components</a>
</h1>
<p id="rfc.section.6.1.p.1">To carry DetNet over MPLS the following is required: </p>

<ol>
<li>A method of identifying the MPLS payload type.</li>
<li>A method of identifying the DetNet flow group to the processing element.</li>
<li>A method of distinguishing DetNet OAM packets from DetNet data packets.</li>
<li>A method of carrying the DetNet sequence number.</li>
<li>A suitable LSP to deliver the packet to the egress PE.</li>
<li>A method of carrying queuing and forwarding indication.</li>
</ol>

<p> </p>
<p id="rfc.section.6.1.p.2">In this design an MPLS service label (the S-Label), similar to a pseudowire (PW) label <a href="#RFC3985" class="xref">[RFC3985]</a>, is used to identify both the DetNet flow identity and the payload MPLS payload type satisfying (1) and (2) in the list above.  OAM traffic discrimination happens through the use of the Associated Channel method described in <a href="#RFC4385" class="xref">[RFC4385]</a>.  The DetNet sequence number is carried in the DetNet Control word which carries the Data/OAM discriminator.  To simplify implementation and to maximize interoperability two sequence number sizes are supported: a 16 bit sequence number and a 28 bit sequence number.  The 16 bit sequence number is needed to support some types of legacy clients. The 28 bit sequence number is used in situations where it is necessary ensure that in high speed networks the sequence number space does not wrap whilst packets are in flight.  </p>
<p id="rfc.section.6.1.p.3">The LSP used to forward the DetNet packet may be of any type (MPLS-LDP, MPLS-TE, MPLS-TP <a href="#RFC5921" class="xref">[RFC5921]</a>, or MPLS-SR <a href="#I-D.ietf-spring-segment-routing-mpls" class="xref">[I-D.ietf-spring-segment-routing-mpls]</a>).  The LSP (F-Label) label and/or the S-Label may be used to indicate the queue processing as well as the forwarding parameters.  Note that the possible use of Penultimate Hop Popping (PHP) means that the only label in a received label stack may be the S-Label.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#pwSolution" id="pwSolution">MPLS Data Plane Encapsulation</a>
</h1>
<p><a href="#fig_pw_mpls" class="xref">Figure 13</a> illustrates a DetNet data plane MPLS encapsulation.  The MPLS-based encapsulation of the DetNet flows is a good fit for the scenarios described in <a href="#sec_ip_mpls_dt_dp_scen" class="xref">Section 4.2.1</a> and <a href="#sec_tsn_mpls_dt_dp_scen" class="xref">Section 4.2.2</a>.  Furthermore, end to end DetNet service i.e., native DetNet deployment (see <a href="#sec_mpls_dt_dp_scen" class="xref">Section 4.2</a>) is also possible if DetNet end systems are capable of initiating and termination MPLS encapsulated packets.  </p>
<p id="rfc.section.6.2.p.2">The MPLS-based DetNet data plane encapsulation consists of: </p>

<ul>
<li>DetNet control word (d-CW) containing sequencing information for packet replication and duplicate elimination purposes, and the OAM indicator.</li>
<li>DetNet service Label (S-Label) that identifies a DetNet flow at the receiving DetNet service sub-layer processing node.  </li>
<li>Zero or more Detnet MPLS  Forwarding label(s) (F-Label) used to direct the packet along the label switched path (LSP) to the next service sub-layer processing node along the path.  When Penultimate Hop Popping is in use there may be no label F-Label in the protocol stack on the final hop.  </li>
<li>The necessary data-link encapsulation is then applied prior to transmission over the physical media.  </li>
</ul>

<p> </p>
<div id="rfc.figure.13"></div>
<div id="fig_pw_mpls"></div>
<pre>
  DetNet MPLS-based encapsulation

+---------------------------------+
|                                 |
|         DetNet App-Flow         |
|         Payload  Packet         |
|                                 |
+---------------------------------+ &lt;--\
|       DetNet Control Word       |    |
+---------------------------------+    +--&gt; DetNet data plane
|           S-Label               |    |    MPLS encapsulation
+---------------------------------+    |
|           F-Label(s)            |    |
+---------------------------------+ &lt;--/
|           Data-Link             |
+---------------------------------+
|           Physical              |
+---------------------------------+

    </pre>
<p class="figure">Figure 13: Encapsulation of a DetNet App-Flow in an MPLS(-TP) PSN</p>
<h1 id="rfc.section.6.2.1">
<a href="#rfc.section.6.2.1">6.2.1.</a> <a href="#dn-sn" id="dn-sn">DetNet Control Word and the DetNet Sequence Number</a>
</h1>
<p id="rfc.section.6.2.1.p.1">A DetNet control word (d-CW) conforms to the Generic PW MPLS Control Word (PWMCW) defined in <a href="#RFC4385" class="xref">[RFC4385]</a>. The d-CW formatted as shown in <a href="#fig_detnet_cw" class="xref">Figure 14</a> MUST be present in all DetNet packets containing app-flow data.  </p>
<div id="rfc.figure.14"></div>
<div id="fig_detnet_cw"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0|                Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    </pre>
<p class="figure">Figure 14: DetNet Control Word</p>
<p></p>

<dl>
<dt>(bits 0 to 3)</dt>
<dd style="margin-left: 8">
<br><br> Per <a href="#RFC4385" class="xref">[RFC4385]</a>, MUST be set to zero (0).  </dd>
<dt>Sequence Number (bits 4 to 31)</dt>
<dd style="margin-left: 8">
<br><br> An unsigned value implementing the DetNet sequence number.  </dd>
</dl>

<p> </p>
<p id="rfc.section.6.2.1.p.3">A separate sequence number space MUST be maintained by the the node that adds the d-CW for each DetNet app-flow.  The following sequence number field lengths MUST be supported: <a href="#cp_considerations" class="xref">Section 7</a>.  </p>

<ul class="empty">
<li>0 bits</li>
<li>16 bits</li>
<li>28 bits</li>
</ul>

<p> The sequence number length MUST be provisioned (configured) on a per app-flow basis via configuration, e.g., the controller plane described in </p>
<p id="rfc.section.6.2.1.p.4">A 0 bit sequence number field length indicates that there is no DetNet sequence number used for the flow.  When the length is zero, the sequence number field MUST be set to zero (0) on all packets sent for the flow.  </p>
<p id="rfc.section.6.2.1.p.5">When the sequence number field length is 16 or 28 bits for a flow, the sequence number MUST be incremented by one for each new app-flow packet sent. When the field length is 16 bits, d-CW bits 4 to 15 MUST be set to zero (0). This values carried in this field can wrap and it is important to note that zero (0) is a valid field value.  For example, were the sequence number size is 16 bits, the sequence will contain: 65535, 0, 1. In this case, zero (0) is an ordinary sequence number. This differs from <a href="#RFC4448" class="xref">[RFC4448]</a> where a sequence number of zero (0) does not indicate that no sequence number field value is in use.  </p>
<p id="rfc.section.6.2.1.p.6">The sequence number is optionally used during receive processing as described below in <a href="#pef-requirements" class="xref">Section 6.2.2.1</a> and <a href="#pof-requirements" class="xref">Section 6.2.2.2</a>.  </p>
<h1 id="rfc.section.6.2.2">
<a href="#rfc.section.6.2.2">6.2.2.</a> <a href="#flow-identification" id="flow-identification">S-Labels</a>
</h1>
<p id="rfc.section.6.2.2.p.1">App-flow identification at a DetNet service sub-layer is realized by an S-Label.  Each app-flow MUST be sent by the node that adds a d-CW with a single specific S-Label value.  MPLS-aware DetNet end systems and edge nodes, which are by definition MPLS ingress and egress nodes, MUST add and remove the d-CW and S-Label.  Relay nodes MAY swap S-Label values when processing an app-flow.  </p>
<p id="rfc.section.6.2.2.p.2">The S-Label value MUST be provisioned per app-flow via configuration, e.g., via the controller plane described in <a href="#cp_considerations" class="xref">Section 7</a>.  Note that S-Labels provide app-flow identification at the downstream DetNet service sub-layer receiver, not the sender.  As such, S-Labels MUST be allocated by the entity that controls the service sub-layer receiving node's label space, and MAY be allocated from the platform label space <a href="#RFC3031" class="xref">[RFC3031]</a>.  </p>
<p id="rfc.section.6.2.2.p.3">The S-Label will normally be at the bottom of the label stack, immediately preceding the d-CW.  To support service sub-layer level OAM, an OAM Associated Channel Header (ACH) <a href="#RFC4385" class="xref">[RFC4385]</a> together with a Generic Associated Channel Label (GAL) <a href="#RFC5586" class="xref">[RFC5586]</a> MAY be used in place of a d-CW.  </p>
<p id="rfc.section.6.2.2.p.4">Similarly, an Entropy Label Indicator/Entropy Label (ELI/EL) <a href="#RFC6790" class="xref">[RFC6790]</a> MAY be carried below the S-Label in the label stack in networks where DetNet flows would otherwise received ECMP treatment.  When ELs are used, the same EL value SHOULD be used for all of the packets sent using a specific S-Label to force the flow to follow the same path.   However, as previously stated in <a href="#dn-gen-encap-solution" class="xref">Section 5</a>, the use of ECMP for DetNet flows is NOT RECOMMENDED. ECMP MAY be used for non-DetNet flows within a DetNet domain.  </p>
<p id="rfc.section.6.2.2.p.5">When receiving a DetNet MPLS flow, an implementation MUST identify the app-flow associated with the incoming packet based on the S-Label.  When a node is using platform labels for S-Labels, no additional information is needed as the S-label uniquely identifies the app-flow.  In the case where platform labels are not used, one or more F-Labels proceeding the S-Label MUST be used together with the S-Label to uniquely identify the incoming app-flows. When PHP is used, the incoming interface MAY also be used to together with any present F-Label(s) and the S-Label to uniquely identify an incoming app-flows.  Note that choice to use platform label space for S-Label or S-Label plus one or more F-Labels to identify app flows is a local implementation choice, with one caveat.  When one or more F-labels, or incoming interface, is needed together with an S-Label to uniquely identify, the controller plane MUST ensure that incoming DetNet MPLS packets arrive with the needed information (F-label(s) and/or incoming interface); the details of such are outside the scope of this document.  </p>
<p id="rfc.section.6.2.2.p.6">While NOT REQUIRED, the use of platform labels for S-Labels matches other pseudowire encapsulations.  This implementation choice also impacts PEF and POF processing as described in the next section.  </p>
<h1 id="rfc.section.6.2.2.1">
<a href="#rfc.section.6.2.2.1">6.2.2.1.</a> <a href="#pef-requirements" id="pef-requirements">Packet Elimination Function                                              Processing</a>
</h1>
<p id="rfc.section.6.2.2.1.p.1">Implementations MAY support the Packet Elimination Function (PEF) for received DetNet MPLS flows.  When supported, use of the PEF for a particular app-flow MUST be provisioned via configuration, e.g., via the controller plane described in <a href="#cp_considerations" class="xref">Section 7</a>.  </p>
<p id="rfc.section.6.2.2.1.p.2">After an app-flow is identified for a received DetNet MPLS packet, as described above, an implementation MUST check if PEF is configured for that app-flow.  When configured the implementation MUST track the sequence number contained in received d-CWs and MUST ensure that duplicate (replicated) instances of a particular sequence number are discarded.  The specific mechanisms used for an implementation to identify which received packets are duplicates and which are new is an implementation choice.  Note that per <a href="#dn-sn" class="xref">Section 6.2.1</a> the sequence number field length may be 16 or 28 bits, and the field value can wrap.  </p>
<p id="rfc.section.6.2.2.1.p.3">Note that an implementation MAY wish to constrain the maximum number sequence numbers that are tracked, on platform-wide or per flow basis.  Some implementations MAY support the provisioning of the maximum number sequence numbers that are tracked number on either a platform-wide or per flow basis.  </p>
<h1 id="rfc.section.6.2.2.2">
<a href="#rfc.section.6.2.2.2">6.2.2.2.</a> <a href="#pof-requirements" id="pof-requirements">Packet Ordering Function                                              Processing</a>
</h1>
<p id="rfc.section.6.2.2.2.p.1">A function that is related to PEF is the Packet Ordering Function (POF).  Implementations MAY support POF. When supported, use of the POF for a particular app-flow MUST be provisioned via configuration, e.g., via the controller plane described by <a href="#cp_considerations" class="xref">Section 7</a>.  Implementations MAY required that PEF and POF be used in combination.  There is no requirement related to the order of execution of the Packet Elimination and Ordering Functions in an implementation.  </p>
<p id="rfc.section.6.2.2.2.p.2">After an app-flow is identified for a received DetNet MPLS packet, as described above, an implementation MUST check if POF is configured for that app-flow.  When configured the implementation MUST track the sequence number contained in received d-CWs and MUST ensure that packets are processed in the order indicated in the received d-CW sequence number field, which may not be in the order the packets are received. As defined in <a href="#dn-sn" class="xref">Section 6.2.1</a> the sequence number field length may be 16 or 28 bits, is incremened by one (1) for each new app-flow packet sent, and the field value can wrap.  The specific mechanisms used for an implementation to identify the order of received packets is an implementation choice.  </p>
<p id="rfc.section.6.2.2.2.p.3">Note that an implementation MAY wish to constrain the maximum number of out of order packets that can be processed, on platform-wide or per flow basis.  Some implementations MAY support the provisioning of this number on either a platform-wide or per flow basis.  The number of out of order packets that can be processed also impacts the latency of a flow.  </p>
<h1 id="rfc.section.6.2.3">
<a href="#rfc.section.6.2.3">6.2.3.</a> <a href="#f-labels" id="f-labels">F-Labels</a>
</h1>
<p id="rfc.section.6.2.3.p.1">F-Labels are support the DetNet forwarding sub-layer. F-Labels are used to provide LSP-based connectivity between DetNet service sub-layer processing nodes.  </p>
<h1 id="rfc.section.6.2.3.1">
<a href="#rfc.section.6.2.3.1">6.2.3.1.</a> <a href="#f-labels-ssl" id="f-labels-ssl">Service Sub-Layer and Packet Replication Function Processing</a>
</h1>
<p id="rfc.section.6.2.3.1.p.1">DetNet MPLS end systems, edge nodes and relay nodes may operate at the DetNet service sub-layer with understand of app-flows and their requirements. As mentioned above, when operating at this layer such nodes can push, pop or swap (pop then push) S-Labels. In all cases, the F-Labels used for the app-flow are always replaced and this section applies.  </p>
<p id="rfc.section.6.2.3.1.p.2">When sending a DetNet flow, Zero or more F-Labels MAY be added on top of an S-Label by the node pushing an S-Label. The F-Labels to be pushed when sending a particular app-flow MUST be provisioned per app-flow via configuration, e.g., via the controller plane discussed in <a href="#cp_considerations" class="xref">Section 7</a>.  To allow for the omission of F-Labels, an implementation SHOULD also allow an outgoing interface to be provisioned.  </p>
<p id="rfc.section.6.2.3.1.p.3">The Packet Replication Function (PRF) function MAY be supported by an implementation for outgoing DetNet flows. When supported, the same app-flow data will be sent over multiple outgoing forwarding sub-layer LSPs.  To support PRF an implementation MUST support the setting of different sets of F-Labels.  Hereto, to allow for the omission of F-Labels, an implementation SHOULD also allow multiple outgoing interfaces to be provisioned. PRF MUST NOT be used with app-flows configured with a d-CW sequence number field length of 0 bits.  </p>
<p id="rfc.section.6.2.3.1.p.4">When a single set of F-Labels is provisioned for a particular outgoing app-flow, that set of F-labels MUST be pushed after the S-Label is pushed.  The outgoing packet is then forwarded as described below in <a href="#f-labels-all" class="xref">Section 6.2.3.2</a>. When a single outgoing interface is provisioned, the outgoing packet is then forwarded as described below in <a href="#f-labels-all" class="xref">Section 6.2.3.2</a>.  </p>
<p id="rfc.section.6.2.3.1.p.5">When multiple sets of F-Labels or interfaces are provisioned for a particular outgoing app-flow, a copy of the outgoing packet, including the pushed S-Label, MUST be made per F-label set and outgoing interface. Each set of provisioned F-Labels are then pushed onto a copy of the packet.  Each copy is then forwarded as described below in <a href="#f-labels-all" class="xref">Section 6.2.3.2</a>.  </p>
<p id="rfc.section.6.2.3.1.p.6">As described in the previous section, when receiving a DetNet MPLS flow, an implementation identifies the app-flow associated with the incoming packet based on the S-Label.  When a node is using platform labels for S-Labels, any F-Labels can be popped and the S-label uniquely identifies the app-flow.  In the case where platform labels are not used, F-Label(s) MUST also be provisioned for incoming app-flows. When PHP is used, incoming interface MUST be provisioned.  The provisioned information MUST then be used to identify incoming app-flows based on the combination of S-Label and F-Label(s) or incoming interface.  </p>
<h1 id="rfc.section.6.2.3.2">
<a href="#rfc.section.6.2.3.2">6.2.3.2.</a> <a href="#f-labels-all" id="f-labels-all">Common F-Label Processing</a>
</h1>
<p id="rfc.section.6.2.3.2.p.1">All DetNet aware MPLS nodes process F-Labels as needed to meet the service requirements of the DetNet flow or flows carried in the LSPs represented by the F-Labels.  This includes normal push, pop and swap operations.  Such processing is essentially the same type of processing enabled for TE LSPs, although the specific service parameters, or traffic specification, can differ.  When the DetNet service parameters of the app-flow or flows carried in an LSP represented by an F-Label can be met by an exiting TE mechanism, the forwarding sub-layer processing node MAY be a DetNet unaware, i.e., standard, MPLS LSR.  Such TE LSPs may provide LSP forwarding service as defined in, but not limited to, <a href="#RFC3209" class="xref">[RFC3209]</a>, <a href="#RFC3270" class="xref">[RFC3270]</a>, <a href="#RFC3272" class="xref">[RFC3272]</a>, <a href="#RFC3473" class="xref">[RFC3473]</a>, <a href="#RFC4875" class="xref">[RFC4875]</a>, <a href="#RFC5440" class="xref">[RFC5440]</a>, and <a href="#RFC6006" class="xref">[RFC6006]</a>.  </p>
<p id="rfc.section.6.2.3.2.p.2">More specifically, as mentioned above, the DetNet forwarding sub-layer provides explicit routes and allocated resources, and F-Labels are used to map to each.  Explicit routes are supported based on the topmost (outermost) F-Label that is pushed or swapped and the LSP that corresponds to this label.  This topmost (outgoing) label MUST be associated with a provisioned outgoing interface and, for non-point-to-point outgoing interfaces, a next hop LSR.  Note that this information MUST be provisioned via configuration or the controller plane.  In the previously mentioned special case where there is no added F-labels and the outgoing interface is not a point-to-point interface, the outgoing interface MUST also be associated with a next hop LSR.  </p>
<p id="rfc.section.6.2.3.2.p.3">Resources may be allocated in a hierarchical fashion per LSP that is represented by each F-Label. Each LSP MAY be provisioned with a service parameters that dictates the specific traffic treatment to be received by the traffic carried over that LSP.  Implementations of this document MUST ensure that traffic carried over each LSP represented by an F-Label receives the traffic treatment provisioned for that LSP.  Typical mechanisms used to provide different treatment to different flows includes the allocation of system resources (such as queues and buffers) and provisioning or related parameters (such as shaping, and policing). Support can also be provided via an underlying network technology such IEEE802.1 TSN <a href="#mpls-over-tsn" class="xref">Section 8</a>. Other than in the TSN case, the specific mechanisms used by a DetNet node to ensure DetNet service delivery requirements are met for supported DetNet flows is outside the scope of this document.  </p>
<p id="rfc.section.6.2.3.2.p.4">Packets that are marked in a way that does not correspond to allocated resources, e.g., lack a provisioned F-Label, can disrupt the QoS offered to properly reserved DetNet flows by using resources allocated to the reserved flows.  Therefore, the network nodes of a DetNet network: </p>

<ul>
<li>MUST defend the DetNet QoS by discarding or remarking (to an allocated DetNet flow or non-competing non-DetNet flow) packets received that are not the subject of a completed resource allocation.  </li>
<li>MUST NOT use a DetNet allocated resource, e.g. a queue or shaper reserved for DetNet flows, for any packet that does match the corresponding DetNet flow.  </li>
<li>MUST ensure a QoS flow does not exceed its allocated resources or provisioned service level, </li>
<li>MUST ensure a CoS flow or  service class does not impact the service delivered to other flows.  This requirement is similar to requirement for MPLS LSRs to that CoS LSPs do not impact the resources allocated to TE LSPs, e.g.,  via <a href="#RFC3473" class="xref">[RFC3473]</a>.  </li>
</ul>

<p> </p>
<p id="rfc.section.6.2.3.2.p.5">Subsequent sections provide additional considerations related to CoS (<a href="#CoS" class="xref">Section 6.6.1</a>), QoS (<a href="#QoS" class="xref">Section 6.6.2</a>) and aggregation (<a href="#Aggregation" class="xref">Section 6.6.3</a>).  </p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#oam-indication" id="oam-indication">OAM Indication</a>
</h1>
<p id="rfc.section.6.3.p.1">OAM follows the procedures set out in <a href="#RFC5085" class="xref">[RFC5085]</a> with the restriction that only Virtual Circuit Connectivity Verification (VCCV) type 1 is supported.</p>
<p id="rfc.section.6.3.p.2">As shown in Figure 3 of <a href="#RFC5085" class="xref">[RFC5085]</a> when the first nibble of the d-CW is 0x0 the payload following the d-CW is normal user data. However, when the first nibble of the d-CW is 0X1, the payload that follows the d-DW is an OAM payload with the OAM type indicated by the value in the d-CW Channel Type field.</p>
<p id="rfc.section.6.3.p.3">The reader is referred to <a href="#RFC5085" class="xref">[RFC5085]</a> for a more detailed description of the Associated Channel mechanism, and to the DetNet work on OAM for more information DetNet OAM.  </p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> <a href="#FAG" id="FAG">Flow Aggregation</a>
</h1>
<p id="rfc.section.6.4.p.1">[Author's note: need to revisit this section and ensure that we cover (and fully specify) desired types of aggregation.] </p>
<p></p>

<ol>
<li>Aggregate at the LSP (Forwarding)</li>
<li>Aggregating DetNet flows as a new DetNet flow</li>
<li>Simple Aggregation at the DetNet layer</li>
</ol>

<p> </p>
<p id="rfc.section.6.4.p.3">The resource control and management aspects of aggregation (including the queuing/shaping/ policing implications) will be covered in other documents.  </p>
<p id="rfc.section.6.4.p.4">The ability to aggregate individual flows, and their associated resource control, into a larger aggregate is an important technique for improving scaling of control in the data, management and control planes.  The DetNet data plane allows for the aggregation of DetNet flows, to improved scaling. There are three methods of introducing flow aggregation: </p>
<p id="rfc.section.6.4.p.5">[Editor's note:] </p>
<p id="rfc.section.6.4.p.6">The following review comments were received when this section was committed to github.  </p>
<p id="rfc.section.6.4.p.7">General comment: We should points to the major issue of aggregation, namely the Seq.Num related problem. The aggregated flows have their own Seq.Num and those are independent. We should consider to group the aggregation techniques as per their impact on what DetNet functions they allow on a DetNet flow. (E.g., aggregation without new Aggregate.Seq.Num would prohibit usage of FR, EF and in-order-delivery function on the aggregate flow).  </p>
<p id="rfc.section.6.4.p.8">SR based aggregation can be treated as a form of H-LSP aggregation.  Should we differentiate them? What are the differences? </p>
<p id="rfc.section.6.4.p.9">What are the issues when aggregating of different payload types? Should we add an editor note on this? </p>
<p id="rfc.section.6.4.p.10">Simple-aggregation-at-the-detnet-layer: is this not the same as H-LSP? The A-label can be treated just as an additional F-Label.  </p>
<p id="rfc.section.6.4.p.11">[Editor's note: End of review comment.] </p>
<h1 id="rfc.section.6.4.1">
<a href="#rfc.section.6.4.1">6.4.1.</a> <a href="#aggregation-at-the-lsp" id="aggregation-at-the-lsp">Aggregation at the LSP</a>
</h1>
<p id="rfc.section.6.4.1.p.1">DetNet flows forwarded via MPLS can leverage MPLS-TE's existing support for hierarchical LSPs (H-LSPs), see <a href="#RFC4206" class="xref">[RFC4206]</a>.  H-LSPs are typically used to aggregate control and resources, they may also be used to provide OAM or protection for the aggregated LSPs.  Arbitrary levels of aggregation naturally falls out of the definition for hierarchy and the MPLS label stack <a href="#RFC3032" class="xref">[RFC3032]</a>.  DetNet nodes which support aggregation (LSP hierarchy) map one or more LSPs (labels) into and from an H-LSP.  Both carried LSPs and H-LSPs may or may not use the TC field, i.e., L-LSPs or E-LSPs.  Such nodes will need to ensure that traffic from aggregated LSPs are placed (shaped/policed/ enqueued) onto the H-LSPs in a fashion that ensures the required DetNet service is preserved.  </p>
<p id="rfc.section.6.4.1.p.2">Additional details of the traffic control capabilities needed at a DetNet-aware node may be covered in the new service descriptions mentioned above or in separate future documents.  Management and control plane mechanisms will also need to ensure that the service required on the aggregate flow (H-LSP or DSCP) are provided, which may include the discarding or remarking mentioned in the previous sections.  </p>
<h1 id="rfc.section.6.4.2">
<a href="#rfc.section.6.4.2">6.4.2.</a> <a href="#aggregating-detnet-flows-as-a-new-detnet-flow" id="aggregating-detnet-flows-as-a-new-detnet-flow">Aggregating DetNet Flows as a new DetNet flow</a>
</h1>
<p id="rfc.section.6.4.2.p.1">An aggregate can be built by layering DetNet flows as shown below: </p>
<pre>
+---------------------------------+
|                                 |
|           DetNet Flow           |
|         Payload  Packet         |
|                                 |
+---------------------------------+ &lt;--\
|       DetNet Control Word       |    |
+=================================+    |
|            S-Label              |    |
+---------------------------------+    +----DetNet data plane
|       DetNet Control Word       |    |    MPLS encapsulation
+=================================+    |
|            A-Label              |    |
+---------------------------------+    |
|           F-Label(s)            | &lt;--/
+---------------------------------+
|           Data-Link             |
+---------------------------------+
|           Physical              |
+---------------------------------+
</pre>
<p id="rfc.section.6.4.2.p.2">Both the Aggregation (A) label and the S-Label have their MPLS S bit set indicating bottom of stack, and the d-CW allows the PREOF to work.  </p>
<p id="rfc.section.6.4.2.p.3">It is a property of the A-label that what follows is d-CW followed by an S-Label. A relay node processing the A-label would not know the underlying payload type. This would only be known to a node that was a peer of the node imposing the S-Label. However there is no real need for it to know the payload type during aggregation processing.  </p>
<h1 id="rfc.section.6.4.3">
<a href="#rfc.section.6.4.3">6.4.3.</a> <a href="#simple-aggregation-at-the-detnet-layer" id="simple-aggregation-at-the-detnet-layer">Simple Aggregation at the DetNet Layer</a>
</h1>
<p id="rfc.section.6.4.3.p.1">Another approach would be not to include a d-CW for the aggregated flow.  This would be functionally similar to aggregation at the forwarding sub-layer using H-LSPs, but would confine knowledge of the aggregation to the DetNet layer. Such an approach shares the disadvantage that PREOF operations would not be possible. OAM operation in this mode is for further study.  </p>
<pre>
 +---------------------------------+
 |                                 |
 |           DetNet Flow           |
 |         Payload  Packet         |
 |                                 |
 +---------------------------------+ &lt;--\
 |       DetNet Control Word       |    |
 +=================================+    |
 |            S-Label              |    +----DetNet data plane
 +---------------------------------+    |    MPLS encapsulation
 |            A-Label              |    |
 +---------------------------------+    |
 |           F-Label(s)            | &lt;--/
 +---------------------------------+
 |           Data-Link             |
 +---------------------------------+
 |           Physical              |
 +---------------------------------+
</pre>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> Service Sub-Layer Considerations</h1>
<p id="rfc.section.6.5.p.1">The edge and relay node internal procedures related to PREOF are implementation specific.  The order of a packet elimination or replication is out of scope in this specification.  However, care should be taken that the replication function does not actually loopback packets as "replicas".  Looped back packets include artificial delay when the node that originally initiated the packet receives it again. Also, looped back packets may make the network condition to look healthier than it actually is (in some cases link failures are not reflected properly because looped back packets make the situation appear better than it actually is).  </p>
<p id="rfc.section.6.5.p.2">It is important that the DetNet layer is configured such that a DetNet node never receives its own replicated packets. If it were to receive such packets the replication function would make the loop more destructive of bandwidth than a conventional unicast loop.  Ultimately the TTL in the S-Label will cause the packet to die during a transient, but given the sensitivity of applications to packet latency the impact on the  DetNet application would be severe.  </p>
<h1 id="rfc.section.6.5.1">
<a href="#rfc.section.6.5.1">6.5.1.</a> <a href="#sec_t_pe" id="sec_t_pe">Edge Node Processing</a>
</h1>
<p id="rfc.section.6.5.1.p.1">An edge node is resposable for matching ingress packets to the service they require and encapsulating them accordingly.An edge node may participate in the packet replication and duplication elimination.  </p>
<p id="rfc.section.6.5.1.p.2">The DetNet-aware forwarder selects the egress DetNet member flow segment based on the flow identification.  The mapping of ingress DetNet member flow segment to egress DetNet member flow segment may be statically or dynamically configured. Additionally the DetNet-aware forwarder does duplicate frame elimination based on the flow identification and the sequence number combination. The packet replication is also done within the DetNet-aware forwarder. During elimination and the replication process the sequence number of the DetNet member flow MUST be preserved and copied to the egress DetNet member flow.  </p>
<p id="rfc.section.6.5.1.p.3">The internal design of a relay node is out of scope of this document. However the reader's attention is drawn to the need to make any PREOF state available to the packet processor(s) dealing with packets to which the PREOF functions must be applied, and to maintain that state is such as way that it is available to the packet processor operation on the next packet in the DetNet flow (which may be a duplicate, a late packet, or the next packet in sequence.  </p>
<p id="rfc.section.6.5.1.p.4">[Editor's note: I think the rest of this section belongs in a new "802.1 TSN (island Interconnect) over DetNet MPLS" section.] </p>
<p id="rfc.section.6.5.1.p.5">This may be done in the DetNet layer, or where the native service processing (NSP) <a href="#RFC3985" class="xref">[RFC3985]</a> is IEEE 802.1CB <a href="#IEEE8021CB" class="xref">[IEEE8021CB]</a> capable, the packet replication and duplicate elimination MAY entirely be done in the NSP, bypassing the DetNet flow encapsulation and logic entirely. This enables operating over unmodified implementations and deployments. The NSP approach works only between edge nodes and cannot make use of relay nodes.  </p>
<p id="rfc.section.6.5.1.p.6">The NSP approach is useful end to end tunnel and for for "island interconnect" scenarios. However, when there is a need to do PREOF in a middle of the network, such plain edge to edge operation is not sufficient.  </p>
<p id="rfc.section.6.5.1.p.7">The extended forwarder MAY copy the sequencing information from the native DetNet packet into the DetNet sequence number field and vice versa. If there is no existing sequencing information available in the native packet or the forwarder chose not to copy it from the native packet, then the extended forwarder MUST maintain a sequence number counter for each DetNet flow (indexed by the DetNet flow identification).  </p>
<h1 id="rfc.section.6.5.2">
<a href="#rfc.section.6.5.2">6.5.2.</a> <a href="#sec_s_pe" id="sec_s_pe">Relay Node Processing</a>
</h1>
<p id="rfc.section.6.5.2.p.1">A DetNet Relay node operates in the DetNet forwarding sub-layer . This processing is done within an extended forwarder function. Whether an ingress DetNet member flow receives DetNet specific processing depends on how the forwarding is programmed.  Some relay nodes may be DetNet service aware, while others may be unmodified LSRs that only understand how to swicth MPLS-TE LSPs.  </p>
<p id="rfc.section.6.5.2.p.2">It is also possible to treat the relay node as a transit node, see <a href="#Aggregation" class="xref">Section 6.6.3</a>.  Again, this is entirely up to how the forwarding has been programmed.  </p>
<h1 id="rfc.section.6.6">
<a href="#rfc.section.6.6">6.6.</a> Forwarding Sub-Layer Considerations</h1>
<h1 id="rfc.section.6.6.1">
<a href="#rfc.section.6.6.1">6.6.1.</a> <a href="#CoS" id="CoS">Class of Service</a>
</h1>
<p id="rfc.section.6.6.1.p.1">Class and quality of service, i.e., CoS and QoS, are terms that are often used interchangeably and confused with each other. In the context of DetNet, CoS is used to refer to mechanisms that provide traffic forwarding treatment based on aggregate group basis and QoS is used to refer to mechanisms that provide traffic forwarding treatment based on a specific DetNet flow basis.  Examples of existing network level CoS mechanisms include DiffServ which is enabled by IP header differentiated services code point (DSCP) field <a href="#RFC2474" class="xref">[RFC2474]</a> and MPLS label traffic class field <a href="#RFC5462" class="xref">[RFC5462]</a>, and at Layer-2, by IEEE 802.1p priority code point (PCP).  </p>
<p id="rfc.section.6.6.1.p.2">CoS for DetNet flows carried in PWs and MPLS is provided using the existing MPLS Differentiated Services (DiffServ) architecture <a href="#RFC3270" class="xref">[RFC3270]</a>.  Both E-LSP and L-LSP MPLS DiffServ modes MAY be used to support DetNet flows.  The Traffic Class field (formerly the EXP field) of an MPLS label follows the definition of <a href="#RFC5462" class="xref">[RFC5462]</a> and <a href="#RFC3270" class="xref">[RFC3270]</a>.  The Uniform, Pipe, and Short Pipe DiffServ tunneling and TTL processing models are described in <a href="#RFC3270" class="xref">[RFC3270]</a> and <a href="#RFC3443" class="xref">[RFC3443]</a> and MAY be used for MPLS LSPs supporting DetNet flows. MPLS ECN MAY also be used as defined in ECN <a href="#RFC5129" class="xref">[RFC5129]</a> and updated by <a href="#RFC5462" class="xref">[RFC5462]</a>.  </p>
<h1 id="rfc.section.6.6.2">
<a href="#rfc.section.6.6.2">6.6.2.</a> <a href="#QoS" id="QoS">Quality of Service</a>
</h1>
<p id="rfc.section.6.6.2.p.1">In addition to explicit routes, and packet replication and elimination, described in <a href="#dn-dt-solution" class="xref">Section 6</a> above, DetNet provides zero congestion loss and bounded latency and jitter.  As described in <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>, there are different mechanisms that maybe used separately or in combination to deliver a zero congestion loss service.  This includes Quality of Service (QoS) mechanisms at the MPLS layer, that may be combined with the mechanisms defined by the underlying network layer such as 802.1TSN.  </p>
<p id="rfc.section.6.6.2.p.2">Quality of Service (QoS) mechanisms for flow specific traffic treatment typically includes a guarantee/agreement for the service, and allocation of resources to support the service.  Example QoS mechanisms include discrete resource allocation, admission control, flow identification and isolation, and sometimes path control, traffic protection, shaping, policing and remarking. Example protocols that support QoS control include <a href="#RFC2205" class="xref">Resource ReSerVation Protocol (RSVP)</a> (RSVP) and RSVP-TE <a href="#RFC3209" class="xref">[RFC3209]</a> and <a href="#RFC3473" class="xref">[RFC3473]</a>.  The existing MPLS mechanisms defined to support CoS <a href="#RFC3270" class="xref">[RFC3270]</a> can also be used to reserve resources for specific traffic classes.  </p>
<p id="rfc.section.6.6.2.p.3">A baseline set of QoS capabilities for DetNet flows carried in PWs and MPLS can provided by MPLS with Traffic Engineering (MPLS-TE) <a href="#RFC3209" class="xref">[RFC3209]</a> and <a href="#RFC3473" class="xref">[RFC3473]</a>.  TE LSPs can also support explicit routes (path pinning).  Current service definitions for packet TE LSPs can be found in "Specification of the Controlled Load Quality of Service", <a href="#RFC2211" class="xref">[RFC2211]</a>, "Specification of Guaranteed Quality of Service", <a href="#RFC2212" class="xref">[RFC2212]</a>, and "Ethernet Traffic Parameters", <a href="#RFC6003" class="xref">[RFC6003]</a>. Additional service definitions are expected in future documents to support the full range of DetNet services.  In all cases, the existing label-based marking mechanisms defined for TE-LSPs and even E-LSPs are use to support the identification of flows requiring DetNet QoS.  </p>
<h1 id="rfc.section.6.6.3">
<a href="#rfc.section.6.6.3">6.6.3.</a> <a href="#Aggregation" id="Aggregation">Cross-DetNet Flow Resource Aggregation</a>
</h1>
<p id="rfc.section.6.6.3.p.1">[Editor's NOTE: Isn't this section the same as "Aggregation at the LSP". -- Address as part of aggregation section cleanup.] </p>
<p id="rfc.section.6.6.3.p.2">The ability to aggregate individual flows, and their associated resource control, into a larger aggregate is an important technique for improving scaling of control in the data, management and control planes.  This document identifies the traffic identification related aspects of aggregation of DetNet flows.  The resource control and management aspects of aggregation (including the queuing/shaping/policing implications) will be covered in other documents.  The data plane implications of aggregation are independent for PW/MPLS and IP encapsulated DetNet flows.  </p>
<p id="rfc.section.6.6.3.p.3">DetNet flows forwarded via MPLS can leverage MPLS-TE's existing support for hierarchical LSPs (H-LSPs), see <a href="#RFC4206" class="xref">[RFC4206]</a>.  H-LSPs are typically used to aggregate control and resources, they may also be used to provide OAM or protection for the aggregated LSPs.  Arbitrary levels of aggregation naturally falls out of the definition for hierarchy and the MPLS label stack <a href="#RFC3032" class="xref">[RFC3032]</a>.  DetNet nodes which support aggregation (LSP hierarchy) map one or more LSPs (labels) into and from an H-LSP.  Both carried LSPs and H-LSPs may or may not use the TC field, i.e., L-LSPs or E-LSPs.  Such nodes will need to ensure that traffic from aggregated LSPs are placed (shaped/policed/enqueued) onto the H-LSPs in a fashion that ensures the required DetNet service is preserved.  </p>
<p id="rfc.section.6.6.3.p.4">[NOTE: This needs to be revised:] Additional details of the traffic control capabilities needed at a DetNet-aware node may be covered in the new service descriptions mentioned above or in separate future documents.  Management and control plane mechanisms will also need to ensure that the service required on the aggregate flow (H-LSP or DSCP) are provided, which may include the  discarding or remarking mentioned in the previous sections.  </p>
<h1 id="rfc.section.6.6.4">
<a href="#rfc.section.6.6.4">6.6.4.</a> Layer 2 Addressing and QoS Considerations</h1>
<p id="rfc.section.6.6.4.p.1">[Editor's NOTE: review and simplify this section. Doesn't this belong in the TSN section? Alternatively, describe in generic/non sub-network technology specific terms.] </p>
<p id="rfc.section.6.6.4.p.2">The Time-Sensitive Networking (TSN) Task Group of the IEEE 802.1 Working Group have defined (and are defining) a number of amendments to <a href="#IEEE8021Q" class="xref">IEEE 802.1Q</a> that provide zero congestion loss and bounded latency in bridged networks.  <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> defines packet replication and elimination functions that should prove both compatible with and useful to, DetNet networks.  </p>
<p id="rfc.section.6.6.4.p.3">As is the case for DetNet, a Layer 2 network node such as a bridge may need to identify the specific DetNet flow to which a packet belongs in order to provide the TSN/DetNet QoS for that packet.  It also will likely need a CoS marking, such as the priority field of an IEEE Std 802.1Q VLAN tag, to give the packet proper service.  </p>
<p id="rfc.section.6.6.4.p.4">Although the flow identification methods described in <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> are flexible, and in fact, include IP 5-tuple identification methods, the baseline TSN standards assume that every Ethernet frame belonging to a TSN stream (i.e. DetNet flow) carries a multicast destination MAC address that is unique to that flow within the bridged network over which it is carried.  Furthermore, <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> describes three methods by which a packet sequence number can be encoded in an Ethernet frame.  </p>
<p id="rfc.section.6.6.4.p.5">Ensuring that the proper Ethernet VLAN tag priority and destination MAC address are used on a DetNet/TSN packet may require further clarification of the customary L2/L3 transformations carried out by routers and edge label switches.  Edge nodes may also have to move sequence number fields among Layer 2, PW, and IP encapsulations.  </p>
<h1 id="rfc.section.6.6.5">
<a href="#rfc.section.6.6.5">6.6.5.</a> Time Synchronization</h1>
<p id="rfc.section.6.6.5.p.1">[Editor's Note: A detailed discussion of time synchronization is outside the scope of this document, and the production of a specialist text discussing this topic is encouraged. This section will be updated/removed if such a document is available before publication of this text.] </p>
<p id="rfc.section.6.6.5.p.2">Time synchronization is important both from the perspective of operating the DetNet network itself and from the perspective of transferring time across the network between client applications.  Some clients may be able to use the DetNet as their provider of time and frequency, others may require the DetNet to transfer time between a client clock source and a client clock user.  </p>
<p id="rfc.section.6.6.5.p.3">For example, <a href="#RFC8169" class="xref">[RFC8169]</a> describes a method of recording the packet queuing time in an MPLS LSR on a packet by per packet basis and forwarding this information to the egress edge system.  This allows compensation for any variable packet queuing delay to be applied at the packet receiver. Other mechanisms for IP/MPLS networks are defined based on IEEE Standard 1588 <a href="#IEEE1588" class="xref">[IEEE1588]</a>, such as ITU-T <a href="#G.8275.1" class="xref">[G.8275.1]</a> and <a href="#G.8275.2" class="xref">[G.8275.2]</a>.  </p>
<p id="rfc.section.6.6.5.p.4">A more detailed discussion of time synchronization is outside the scope of this document.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#cp_considerations" id="cp_considerations">Controller Plane (Management and Control)                 Considerations</a>
</h1>
<p id="rfc.section.7.p.1">While management plane and control planes are traditionally considered separately, from the Data Plane perspective there is no practical difference based on the origin of flow provisioning information, and the DetNet architecture <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a> refers to these collectively as the 'Controller Plane'.  This document therefore does not distinguish between information provided by distributed control plane protocols, e.g., RSVP-TE <a href="#RFC3209" class="xref">[RFC3209]</a> and <a href="#RFC3473" class="xref">[RFC3473]</a>, or by centralized network management mechanisms, e.g., RestConf <a href="#RFC8040" class="xref">[RFC8040]</a>, YANG <a href="#RFC7950" class="xref">[RFC7950]</a>, and the Path Computation Element Communication Protocol (PCEP) <a href="#I-D.ietf-pce-pcep-extension-for-pce-controller" class="xref">[I-D.ietf-pce-pcep-extension-for-pce-controller]</a> or any combination thereof. Specific considerations and requirements for the DetNet Controller Plane are discussed in <a href="#control-management-requirements" class="xref">Section 7.6</a>.  </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> S-Label and F-Label Assignment and Distribution</h1>
<p id="rfc.section.7.1.p.1">[Editor's note - we may need additional text on resource allocation in this section.] </p>
<p id="rfc.section.7.1.p.2">DetNet S-Labels (see <a href="#flow-identification" class="xref">Section 6.2.2</a> for their definition) are similar to other MPLS service labels that denote the contents of the MPLS packet payload such as a layer 2 pseudowire, an IP packet that is routed in a VPN context with a private address, or an Ethernet virtual private network (EVPN) service.  </p>
<p id="rfc.section.7.1.p.3">S-Labels are expected to be allocated in the same manner as any other service labels. S-Labels uniquely identify a particular DetNet flow, and are local to the node on which the label is allocated. In the DetNet service sub-layer the explicit route consists of the set of Relay Nodes that the DetNet flow must traverse.  They can be used to identify the DetNet flow that a packet belongs to as it traverses a particular node in a DetNet domain. Because labels are local to each node rather than being a global identifier within a domain, they must be advertised to their upstream DetNet service-aware peer nodes (e.g., a DetNet MPLS End System as shown in <a href="#fig_pw_detnet" class="xref">Figure 3</a>, or a DetNet Relay or Edge Node as shown in <a href="#fig_pw_detnet2" class="xref">Figure 7</a>) and interpreted in the context of their received F-Label.  </p>
<p id="rfc.section.7.1.p.4">As discussed in <a href="#sec_dt_dp" class="xref">Section 4</a>, the forwarding sub-layer uses one or more F-Labels to forward DetNet packets between DetNet service-aware nodes along explicitly defined routes at the DetNet forwarding sub-layer, which in the context of this document is the MPLS layer.  In the DetNet Forwarding (MPLS) sub-layer the explicit route consists of the set of DetNet nodes which are LSRs, links, and possibly link bundle members and queues that the DetNet packets of a flow must traverse between nodes in the DetNet service sub-layer (i.e. between a specific Edge Node and the next hop Relay Node, between specific Relay Nodes, and between a specific Relay node and the egress Edge Node. Resource allocation corresponding to the set of Services supported over the forwarding sub-layer, which may or may not include aggregation, is required at this sub-layer. Explicit routes are used to ensure that packets are routed through the resources that have been reserved for them, and hence provide the DetNet application with the required service.  </p>
<p id="rfc.section.7.1.p.5">Whether configuring, calculating and instantiating these routes is a single-stage or multi-stage process, or in a centralized or distributed manner, is out of scope of this document.  </p>
<p id="rfc.section.7.1.p.6">There are a number of approaches that could be used to provide explicit routes and resource allocation in the MPLS layer: <a href="#control-management-requirements" class="xref">Section 7.6</a> for further discussion of these alternatives.  </p>

<ul>
<li>The path could be explicitly set up by a controller which calculates the path and explicitly configures each node along that path with the appropriate forwarding and resource allocation information.  </li>
<li>The path could be set up using RSVP-TE signaling.  </li>
<li>The path could be implemented using MPLS-based segment routing when extended to support resource allocation.  </li>
</ul>

<p> See </p>
<p id="rfc.section.7.1.p.7">Much like other MPLS labels, there are a number of alternatives available for DetNet S-Label and F-Label advertisement to an upstream peer node. These include distributed signaling protocols such as RSVP-TE, centralized label distribution via a controller that manages both the sender and the receiver using NETCONF/YANG, BGP, PCEP, etc., and hybrid combinations of the two.  The details of the controller plane solution required for the label distribution and the management of the label number space are out of scope of this document, but as mentioned above, there are particular DetNet considerations and requirements that are discussed in <a href="#control-management-requirements" class="xref">Section 7.6</a>.  </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> Packet Replication, Elimination, and Ordering (PREOF)</h1>
<p id="rfc.section.7.2.p.1">The controller plane protocol solution required for managing the PREOF processing is outside the scope of this document. That said, it should be noted that the ability to determine, for a particular flow, optimal packet replication and elimination points in the DetNet domain requires explicit support. There are be capabilities that can be used, or extended, for example GMPLS end-to-end recovery <a href="#RFC4872" class="xref">[RFC4872]</a> and GMPLS segment recovery <a href="#RFC4873" class="xref">[RFC4873]</a>.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> Contention Loss and Jitter Reduction</h1>
<p id="rfc.section.7.3.p.1">As discussed in <a href="#sec_intro" class="xref">Section 1</a>, this document does not specify the mechanisms needed to eliminate contention loss or reduce jitter for DetNet flows at the DetNet forwarding sub-layer.  The ability to manage node and link resources to be able to provide these functions will be a necessary part of the DetNet controller plane. It will also be necessary to be able to control the required queuing mechanisms used to provide these functions along a flow's path through the network. See <a href="#control-management-requirements" class="xref">Section 7.6</a> for further discussion of these requirements.  </p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> Bidirectional Traffic</h1>
<p id="rfc.section.7.4.p.1">Some DetNet applications generate bidirectional traffic.  Using MPLS definitions <a href="#RFC5654" class="xref">[RFC5654]</a> there are associated bidirectional flows, and co-routed bidirectional flows.  MPLS defines a point-to-point associated bidirectional LSP as consisting of two unidirectional point-to-point LSPs, one from A to B and the other from B to A, which are regarded as providing a single logical bidirectional forwarding path.  This would be analogous of standard IP routing, or PWs running over two reciprocal unidirection LSPs.  MPLS defines a point-to-point co-routed bidirectional LSP as an associated bidirectional LSP which satisfies the additional constraint that its two unidirectional component LSPs follow the same path (in terms of both nodes and links) in both directions.  An important property of co-routed bidirectional LSPs is that their unidirectional component LSPs share fate.  In both types of bidirectional LSPs, resource reservations may differ in each direction.  The concepts of associated bidirectional flows and co-routed bidirectional flows can be applied to DetNet flows.  </p>
<p id="rfc.section.7.4.p.2">While the MPLS data plane must support bidirectional DetNet flows, there are no special bidirectional features with respect to the data plane other than the need for the two directions of a co-routed bidirectional flow to take the same path.  Fate sharing and associated vs co-routed bidirectional flows can be managed at the control level.  Note that there is no stated requirement for bidirectional DetNet flows to be supported using the same MPLS Labels in each direction.  </p>
<p id="rfc.section.7.4.p.3">DetNet's use of PREOF may increase the complexity of using co-routing bidirectional flows, since if PREOF is used, then the replication points in one direction would have to match the elimination points in the other direction, and vice versa, and the optimal points for these functions in one direction may not match the optimal points in the other.  </p>
<p id="rfc.section.7.4.p.4">Control and management mechanisms will need to support bidirectional flows, but the specification of such mechanisms are out of scope of this document. Related control plan mechanisms have been defined in <a href="#RFC3473" class="xref">[RFC3473]</a>, <a href="#RFC6387" class="xref">[RFC6387]</a> and <a href="#RFC7551" class="xref">[RFC7551]</a>.  </p>
<p id="rfc.section.7.4.p.5">This is further discussed in <a href="#control-management-requirements" class="xref">Section 7.6</a>.  </p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> Flow Aggregation Control</h1>
<p><a href="#FAG" class="xref">Section 6.4</a> discusses the use of flow aggregation in DetNet. It includes flow aggregation accomplished through the use of hierarchical LSPs, aggregating multiple DetNet flows into a single new DetNet flow, and simple aggregation at the DetNet layer. It will be the responsibility of the DetNet controller plane to be able to properly provision the use of these mechanisms. These requirements are included in the next section.  </p>
<h1 id="rfc.section.7.6">
<a href="#rfc.section.7.6">7.6.</a> <a href="#control-management-requirements" id="control-management-requirements">DetNet                                                           Controller (Control and Management) Plane Requirements</a>
</h1>
<p id="rfc.section.7.6.p.1">While the definition of controller plane for DetNet is out of the scope of this document, there are particular considerations and requirements for such that result from the unique characteristics of the DetNet architecture <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a> and data plane as defined herein.  </p>
<p id="rfc.section.7.6.p.2">The primary requirements of the DetNet controller plane are that it must be able to: </p>

<ul>
<li>Instantiate DetNet flows in a DetNet domain (which may include some or all of explicit path and PREOF replication and elimination node determination, link bandwidth reservations, node buffer and other resource reservations, specification of required queuing disciplines along the path, ability to manage bidirectional flows, etc.) as needed for a flow.</li>
<li>Manage DetNet S-Label and F-Label allocation and distribution, when the DetNet MPLS encapsulation is in use</li>
<li>The ability to support DetNet flow aggregation</li>
<li>Advertise static and dynamic node and link resources such as capabilities and adjacencies to other network nodes (for dynamic signaling approaches) or to network controllers (for centralized approaches)</li>
<li>Scale to handle a large number of DetNet flows in a domain (which may require per-flow signaling or provisioning)</li>
<li>Provision flow identification information at each of the nodes along the path, and it may differ depending on the location in the network and the DetNet functionality (e.g. transit node vs. relay node).</li>
</ul>

<p> </p>
<p id="rfc.section.7.6.p.3">These requirements, as stated earlier, could be satisfied using distributed control protocol signaling (such as RSVP-TE), centralized network management provisioning mechanisms (such as BGP, PCEP, YANG <a href="#I-D.ietf-detnet-flow-information-model" class="xref">[I-D.ietf-detnet-flow-information-model]</a>, etc.) or hybrid combinations of the two, and could also make use of MPLS-based segment routing.  </p>
<p id="rfc.section.7.6.p.4">In the abstract, the results of either distributed signaling or centralized provisioning are equivalent from a DetNet data plane perspective - flows are instantiated, explicit routes are determined, resources are reserved, and packets are forwarded through the domain using the MPLS data plane.  </p>
<p id="rfc.section.7.6.p.5">However, from a practical and implementation standpoint, they are not equivalent at all. Some approaches are more scalable than others in terms of signaling load on the network. Some can take advantage of global tracking of resources in the DetNet domain for better overall network resource optimization. Some are more resilient than others if link, node, or management equipment failures occur. While a detailed analysis of the control plane alternatives is out of the scope of this document, the requirements from this document can be used as the basis of a later analysis of the alternatives.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#mpls-over-tsn" id="mpls-over-tsn">DetNet MPLS Operation Over IEEE 802.1 TSN Sub-Networks</a>
</h1>
<p id="rfc.section.8.p.1">[Editor's note: this is a place holder section.  A standalone section on MPLS over IEEE 802.1 TSN.  Includes RFC2119 Language.] </p>
<p id="rfc.section.8.p.2">This section covers how DetNet MPLS flows operate over an IEEE 802.1 TSN sub-network.  <a href="#fig_mpls_detnet_to_tsn" class="xref">Figure 15</a> illustrates such a scenario, where two MPLS (DetNet) nodes are interconnected by a TSN sub-network. Node-1 is single homed and Node-2 is dual-homed.  MPLS nodes can be (1) DetNet MPLS End System, (2) DetNet MPLS Edge or Relay node or (3) MPLS Transit node.  </p>
<p id="rfc.section.8.p.3">Note: in case of MPLS Transit node there is no DetNet Service sub-layer processing.</p>
<div id="rfc.figure.15"></div>
<div id="fig_mpls_detnet_to_tsn"></div>
<pre>
   MPLS (DetNet)                 MPLS (DetNet)
      Node-1                        Node-2

   +----------+                  +----------+
&lt;--| Service* |-- DetNet flow ---| Service* |--&gt;
   +----------+                  +----------+
   |Forwarding|                  |Forwarding|
   +--------.-+    &lt;-TSN Str-&gt;   +-.-----.--+
             \      ,-------.     /     /
              +----[ TSN-Sub ]---+     /
                   [ Network ]--------+
                    `-------'
&lt;---------------- DetNet MPLS ---------------&gt;

Note: * no service sub-layer required for transit nodes
</pre>
<p class="figure">Figure 15: DetNet Enabled MPLS Network Over a TSN Sub-Network</p>
<p id="rfc.section.8.p.4">The Time-Sensitive Networking (TSN) Task Group of the IEEE 802.1 Working Group have defined (and are defining) a number of amendments to <a href="#IEEE8021Q" class="xref">IEEE 802.1Q</a> that provide zero congestion loss and bounded latency in bridged networks. Furthermore <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> defines frame replication and elimination functions for reliability that should prove both compatible with and useful to, DetNet networks.  All these functions have to identify flows those require TSN treatment.  </p>
<p id="rfc.section.8.p.5">As is the case for DetNet, a Layer 2 network node such as a bridge may need to identify the specific DetNet flow to which a packet belongs in order to provide the TSN/DetNet QoS for that packet.  It also may need a CoS marking, such as the priority field of an IEEE Std 802.1Q VLAN tag, to give the packet proper service.  </p>
<p id="rfc.section.8.p.6">The challange for MPLS DeNet flows is that the protocol interworking function defined in <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> works only for IP flows. The aim of the protocol interworking function is to convert an ingress flow to use a specific multicast destination MAC address and VLAN, for example to direct the packets through a specific path inside the bridged network. A similar interworking pair at the other end of the TSN sub-network would restore the packet to its original destination MAC address and VLAN.  </p>
<p id="rfc.section.8.p.7">As protocol interworking function defined in <a href="#IEEE8021CB" class="xref">[IEEE8021CB]</a> does not work for MPLS labeled flows, the DetNet MPLS nodes MUST ensure proper TSN sub-network specific Ethernet encapsulation of the DetNet MPLS packets. For a given TSN Stream (i.e., DetNet flow) an MPLS (DetNet) node MUST behave as a TSN-aware Talker or a Listener inside the TSN sub-network.  </p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Mapping of TSN Stream ID and Sequence Number</h1>
<p id="rfc.section.8.1.p.1">TSN capable MPLS (DetNet) nodes are TSN-aware Talker/Listener as shown in <a href="#fig_mpls_with_tsn" class="xref">Figure 16</a>.  MPLS (DetNet) node MUST provide the TSN sub-network specific Ethernet encapsulation over the link(s) towards the sub-network. An TSN-aware MPLS (DetNet) node MUST support the following TSN components: </p>

<ol>
<li>For recognizing flows: <ul><li>Stream Identification (MPLS-flow-aware)</li></ul>
<p> </p>
</li>
<li>For FRER used inside the TSN domain, additonaly: <ul>
<li>Sequencing function (MPLS-flow-aware)</li>
<li>Sequence encode/decode function</li>
</ul>
<p> </p>
</li>
<li>For FRER when the node is a TSN replication or elimination point, additionally: <ul>
<li>Stream splitting function</li>
<li>Individual recovery function</li>
</ul>
<p> </p>
</li>
</ol>

<p> </p>
<p id="rfc.section.8.1.p.2">[Editor's note: Should we added here requirements regarding IEEE 802.1Q C-VLAN component?] </p>
<p id="rfc.section.8.1.p.3">The Stream Identification and The Sequencing functions are slightly modified for frames passed down the protocol stack from the upper layers.  </p>
<p id="rfc.section.8.1.p.4">Stream Identification MUST pair MPLS flows and TSN Streams and encode that in data plane formats as well.  The packet's stream_handle subparameter (see <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a>) inside the Talker/Listener is defined based on the Flow-ID used in the upper DetNet MPLS layer.  Stream Identification function MUST encode Ethernet header fields namely (1) the destination MAC-address, (2) the VLAN-ID and (3) priority parameters with TSN sub-network specific values. Encoding is provided for the frame passed down the stack from the upper layers.  </p>
<p id="rfc.section.8.1.p.5">The sequence generation function resides in the Sequencing function. It generates a sequence_number subparameter for each packet of a Stream passed down to the lower layers.  Sequencing function MUST copy sequence information from the MPLS d-CW of the packet to the sequence_number subparameter for the frame passed down the stack from the upper layers.  </p>
<div id="rfc.figure.16"></div>
<div id="fig_mpls_with_tsn"></div>
<pre>
   MPLS (DetNet)
      Node-1
   &lt;----------&gt;

   +----------+
&lt;--| Service  |-- DetNet flow ------------------
   +----------+
   |Forwarding|
   +----------+    +---------------+
   | L2 with  |&lt;---| L2 Relay with |---- TSN ----
   |   TSN    |    | TSN function  |    Stream
   +-----.----+    +--.---------.--+
          \__________/           \______

    TSN-aware
     Talker /          TSN-Bridge
     Listener             Relay

         &lt;--------- TSN sub-network ------------
</pre>
<p class="figure">Figure 16: MPLS (DetNet) Node with TSN Functions</p>
<p id="rfc.section.8.1.p.6">The Sequence encode/decode function MUST support the Redundancy tag (R-TAG) format as per Clause 7.8 of <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a>.  </p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> TSN Usage of FRER</h1>
<p id="rfc.section.8.2.p.1">TSN Streams supporting DetNet flows may use Frame Replication and Elimination for Redundancy (FRER) [802.1CB] based on the loss service requirements of the TSN Stream, which is derived from the DetNet service requirements of the DetNet mapped flow.  The specific operation of FRER is not modified by the use of DetNet and follows  <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a>.  </p>
<p id="rfc.section.8.2.p.2">FRER function and the provided service recovery is available only within the TSN sub-network however as the Stream-ID and the TSN sequence number are paired with the MPLS flow parameters they can be combined with PREOF functions.  </p>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> Management and Control Implications</h1>
<p id="rfc.section.8.3.p.1">[Editor's note: This section is TBD Covers Creation, mapping, removal of TSN Stream IDs, related parameters and,when needed, configuration of FRER. Supported by management/control plane.] </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#mpls-over-ip" id="mpls-over-ip">DetNet MPLS Operation over DetNet                                       IP PSNs</a>
</h1>
<p id="rfc.section.9.p.1">This section specifies the DetNet encapsulation over an IP network.  The approach is modeled on the operation of MPLS and PseudoWires (PW) over an IP Packet Switched Network (PSN) <a href="#RFC3985" class="xref">[RFC3985]</a><a href="#RFC4385" class="xref">[RFC4385]</a><a href="#RFC7510" class="xref">[RFC7510]</a>.  It maps the MPLS data plane encapsulation described in <a href="#pwSolution" class="xref">Section 6.2</a> to the DetNet IP data plane define in <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>.  </p>
<p id="rfc.section.9.p.2">To carry DetNet with full functionality at the DetNet layer over an IP network, the following components are required (these are a subset of the requirements for MPLS encapsulation listed in <a href="#dn-MPLS-en-comps" class="xref">Section 6.1</a>): </p>
<p></p>

<ol>
<li>A method of identifying the DetNet flow group to the processing element.</li>
<li>A method of carrying the DetNet sequence number.</li>
<li>A method of distinguishing DetNet OAM packets from DetNet data packets.</li>
<li>A method of carrying queuing and forwarding indication.</li>
</ol>

<p> </p>
<p id="rfc.section.9.p.4">These requirements are satisfied by the DetNet over MPLS Encapsulation described in <a href="#pwSolution" class="xref">Section 6.2</a>.  </p>
<p id="rfc.section.9.p.5">This document builds on the the specification of MPLS over UDP and IP defined in <a href="#RFC7510" class="xref">[RFC7510]</a>.  It replaces the the F-Label(s) used in <a href="#pwSolution" class="xref">Section 6.2</a> with UDP and IP headers.  The UDP and IP header information is used to identify DetNet flows, including member flows, per <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>. The resulting encapsulation is shown in  <a href="#IP-encap-dn" class="xref">Figure 17</a>.  </p>
<p id="rfc.section.9.p.6">Note that this encapsulation works equally well with IPv4 and IPv6.  </p>
<div id="rfc.figure.17"></div>
<div id="IP-encap-dn"></div>
<pre>
+---------------------------------+
|                                 |
|         DetNet App-Flow         |
|         Payload  Packet         |
|                                 |
+---------------------------------+ &lt;--\
|       DetNet Control Word       |    |
+---------------------------------+    +--&gt; DetNet data plane
|             S-Label             |    |    MPLS encapsulation
+---------------------------------+ &lt;--X.
|           UDP Header            |    |
+---------------------------------+    +--&gt; DetNet data plane
|           IP Header             |    |    IP encapsulation
+---------------------------------+ &lt;--/
|           Data-Link             |
+---------------------------------+
|           Physical              |
+---------------------------------+

 </pre>
<p class="figure">Figure 17: IP Encapsulation of DetNet MPLS</p>
<p id="rfc.section.9.p.7">d-CW and and S-Labels are used as defined in <a href="#pwSolution" class="xref">Section 6.2</a> and are not modified by this section.  </p>
<p id="rfc.section.9.p.8">To support outgoing DetNet MPLS over IP, an implementation MUST support the provisioning of IP/UDP header information in place of sets of F-Labels.  Note that multiple sets of F-Labels can be provisioned to support PRF on transmitted DetNet flows and therefore, when PRF is supported, multiple IP/UDP headers MAY be provisioned. When multiple IP/UDP headers are provisioned for a particular outgoing app-flow, a copy of the outgoing packet, including the pushed S-Label, MUST be made for each. The headers for each outgoing packet MUST be based on the configuration information and as defined in <a href="#RFC7510" class="xref">[RFC7510]</a>, with one exception.  The one exceptions is that the UDP Source Port value MUST be set to uniquely identify the DetNet (forwarding sub-layer) flow.  The packet MUST then be handed as a DetNet IP packet, per <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>.  </p>
<p id="rfc.section.9.p.9">To support receive processing an implementation MUST also support the provisioning of received IP/UDP header information.  When S-Labels are taken from platform label space, all that is required is to provision that receiving IP/UDP encapsulated DetNet MPLS packets is permitted.  Once the IP/UDP header is stripped, the S-label uniquely identifies the app-flow.  When S-Labels are not taken from platform label space, IP/UDP header information MUST be provisioned.  The provisioned information MUST then be used to identify incoming app-flows based on the combination of S-Label and incoming IP/UDP header.  Normal receive processing, including PEOF can then take place.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Security Considerations</h1>
<p id="rfc.section.10.p.1">The security considerations of DetNet in general are discussed in <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a> and <a href="#I-D.sdt-detnet-security" class="xref">[I-D.sdt-detnet-security]</a>. Other security considerations will be added in a future version of this draft.  </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.11.p.1">This document makes no IANA requests.  </p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#Contributors" id="Contributors">Contributors</a>
</h1>
<p id="rfc.section.12.p.1">RFC7322 limits the number of authors listed on the front page of a draft to a maximum of 5, far fewer than the many individuals below who made important contributions to this draft. The editor wishes to thank and acknowledge each of the following authors for contributing text to this draft. See also <a href="#acks" class="xref">Section 13</a>.  </p>
<pre>
   Loa Andersson
   Huawei
   Email: loa@pi.nu

   Yuanlong Jiang
   Huawei
   Email: jiangyuanlong@huawei.com

   Norman Finn
   Huawei
   3101 Rio Way
   Spring Valley, CA  91977
   USA
   Email: norman.finn@mail01.huawei.com

   Janos Farkas
   Ericsson
   Magyar Tudosok krt. 11.
   Budapest  1117
   Hungary
   Email: janos.farkas@ericsson.com

   Carlos J. Bernardos
   Universidad Carlos III de Madrid
   Av. Universidad, 30
   Leganes, Madrid  28911
   Spain
   Email: cjbc@it.uc3m.es

   Tal Mizrahi
   Marvell
   6 Hamada st.
   Yokneam
   Israel
   Email: talmi@marvell.com

   Lou Berger
   LabN Consulting, L.L.C.
   Email: lberger@labn.net

   Stewart Bryant
   Huawei Technologies
   Email: stewart.bryant@gmail.com

   Mach Chen
   Huawei Technologies
   Email: mach.chen@huawei.com

   Andrew G. Malis
   Huawei Technologies
   Email: agmalis@gmail.com
   </pre>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#acks" id="acks">Acknowledgements</a>
</h1>
<p id="rfc.section.13.p.1">The author(s) ACK and NACK.  </p>
<p id="rfc.section.13.p.2">The following people were part of the DetNet Data Plane Solution Design Team: </p>

<ul class="empty">
<li>Jouni Korhonen</li>
<li>J&#225;nos Farkas</li>
<li>Norman Finn</li>
<li>Bal&#225;zs Varga</li>
<li>Loa Andersson</li>
<li>Tal Mizrahi</li>
<li>David Mozes</li>
<li>Yuanlong Jiang</li>
<li>Andrew Malis</li>
<li>Carlos J. Bernardos</li>
</ul>
<p id="rfc.section.13.p.3">The DetNet chairs serving during the DetNet Data Plane Solution Design Team: </p>

<ul class="empty">
<li>Lou Berger</li>
<li>Pat Thaler</li>
</ul>
<p id="rfc.section.13.p.4">Thanks for Stewart Bryant for his extensive review of the previous versions of the document.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">14.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">14.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2211">[RFC2211]</b></td>
<td class="top">
<a>Wroclawski, J.</a>, "<a href="https://tools.ietf.org/html/rfc2211">Specification of the Controlled-Load Network Element Service</a>", RFC 2211, DOI 10.17487/RFC2211, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2212">[RFC2212]</b></td>
<td class="top">
<a>Shenker, S.</a>, <a>Partridge, C.</a> and <a>R. Guerin</a>, "<a href="https://tools.ietf.org/html/rfc2212">Specification of Guaranteed Quality of Service</a>", RFC 2212, DOI 10.17487/RFC2212, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3031">[RFC3031]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Viswanathan, A.</a> and <a>R. Callon</a>, "<a href="https://tools.ietf.org/html/rfc3031">Multiprotocol Label Switching Architecture</a>", RFC 3031, DOI 10.17487/RFC3031, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3032">[RFC3032]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Tappan, D.</a>, <a>Fedorkow, G.</a>, <a>Rekhter, Y.</a>, <a>Farinacci, D.</a>, <a>Li, T.</a> and <a>A. Conta</a>, "<a href="https://tools.ietf.org/html/rfc3032">MPLS Label Stack Encoding</a>", RFC 3032, DOI 10.17487/RFC3032, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3209">[RFC3209]</b></td>
<td class="top">
<a>Awduche, D.</a>, <a>Berger, L.</a>, <a>Gan, D.</a>, <a>Li, T.</a>, <a>Srinivasan, V.</a> and <a>G. Swallow</a>, "<a href="https://tools.ietf.org/html/rfc3209">RSVP-TE: Extensions to RSVP for LSP Tunnels</a>", RFC 3209, DOI 10.17487/RFC3209, December 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3270">[RFC3270]</b></td>
<td class="top">
<a>Le Faucheur, F.</a>, <a>Wu, L.</a>, <a>Davie, B.</a>, <a>Davari, S.</a>, <a>Vaananen, P.</a>, <a>Krishnan, R.</a>, <a>Cheval, P.</a> and <a>J. Heinanen</a>, "<a href="https://tools.ietf.org/html/rfc3270">Multi-Protocol Label Switching (MPLS) Support of Differentiated Services</a>", RFC 3270, DOI 10.17487/RFC3270, May 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3443">[RFC3443]</b></td>
<td class="top">
<a>Agarwal, P.</a> and <a>B. Akyol</a>, "<a href="https://tools.ietf.org/html/rfc3443">Time To Live (TTL) Processing in Multi-Protocol Label Switching (MPLS) Networks</a>", RFC 3443, DOI 10.17487/RFC3443, January 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3473">[RFC3473]</b></td>
<td class="top">
<a>Berger, L.</a>, "<a href="https://tools.ietf.org/html/rfc3473">Generalized Multi-Protocol Label Switching (GMPLS) Signaling Resource ReserVation Protocol-Traffic Engineering (RSVP-TE) Extensions</a>", RFC 3473, DOI 10.17487/RFC3473, January 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4206">[RFC4206]</b></td>
<td class="top">
<a>Kompella, K.</a> and <a>Y. Rekhter</a>, "<a href="https://tools.ietf.org/html/rfc4206">Label Switched Paths (LSP) Hierarchy with Generalized Multi-Protocol Label Switching (GMPLS) Traffic Engineering (TE)</a>", RFC 4206, DOI 10.17487/RFC4206, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4385">[RFC4385]</b></td>
<td class="top">
<a>Bryant, S.</a>, <a>Swallow, G.</a>, <a>Martini, L.</a> and <a>D. McPherson</a>, "<a href="https://tools.ietf.org/html/rfc4385">Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN</a>", RFC 4385, DOI 10.17487/RFC4385, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5085">[RFC5085]</b></td>
<td class="top">
<a>Nadeau, T.</a> and <a>C. Pignataro</a>, "<a href="https://tools.ietf.org/html/rfc5085">Pseudowire Virtual Circuit Connectivity Verification (VCCV): A Control Channel for Pseudowires</a>", RFC 5085, DOI 10.17487/RFC5085, December 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5129">[RFC5129]</b></td>
<td class="top">
<a>Davie, B.</a>, <a>Briscoe, B.</a> and <a>J. Tay</a>, "<a href="https://tools.ietf.org/html/rfc5129">Explicit Congestion Marking in MPLS</a>", RFC 5129, DOI 10.17487/RFC5129, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5462">[RFC5462]</b></td>
<td class="top">
<a>Andersson, L.</a> and <a>R. Asati</a>, "<a href="https://tools.ietf.org/html/rfc5462">Multiprotocol Label Switching (MPLS) Label Stack Entry: "EXP" Field Renamed to "Traffic Class" Field</a>", RFC 5462, DOI 10.17487/RFC5462, February 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7510">[RFC7510]</b></td>
<td class="top">
<a>Xu, X.</a>, <a>Sheth, N.</a>, <a>Yong, L.</a>, <a>Callon, R.</a> and <a>D. Black</a>, "<a href="https://tools.ietf.org/html/rfc7510">Encapsulating MPLS in UDP</a>", RFC 7510, DOI 10.17487/RFC7510, April 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">14.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="G.8275.1">[G.8275.1]</b></td>
<td class="top">
<a>International Telecommunication Union</a>, "<a href="https://www.itu.int/rec/T-REC-G.8275.1/en">Precision time protocol telecom profile for phase/time synchronization with full timing support from the network</a>", ITU-T G.8275.1/Y.1369.1 G.8275.1, June 2016.</td>
</tr>
<tr>
<td class="reference"><b id="G.8275.2">[G.8275.2]</b></td>
<td class="top">
<a>International Telecommunication Union</a>, "<a href="https://www.itu.int/rec/T-REC-G.8275.2/en">Precision time protocol telecom profile for phase/time synchronization with partial timing support from the network</a>", ITU-T G.8275.2/Y.1369.2 G.8275.2, June 2016.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-detnet-architecture">[I-D.ietf-detnet-architecture]</b></td>
<td class="top">
<a>Finn, N.</a>, <a>Thubert, P.</a>, <a>Varga, B.</a> and <a>J. Farkas</a>, "<a href="https://tools.ietf.org/html/draft-ietf-detnet-architecture-11">Deterministic Networking Architecture</a>", Internet-Draft draft-ietf-detnet-architecture-11, February 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-detnet-dp-sol-ip">[I-D.ietf-detnet-dp-sol-ip]</b></td>
<td class="top">
<a>Korhonen, J., Varga, B.</a>, "<a>DetNet IP Data Plane Encapsulation</a>", 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-detnet-flow-information-model">[I-D.ietf-detnet-flow-information-model]</b></td>
<td class="top">
<a>Farkas, J.</a>, <a>Varga, B.</a>, <a>Cummings, R.</a>, <a>Jiang, Y.</a> and <a>Y. Zha</a>, "<a href="https://tools.ietf.org/html/draft-ietf-detnet-flow-information-model-02">DetNet Flow Information Model</a>", Internet-Draft draft-ietf-detnet-flow-information-model-02, October 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-pce-pcep-extension-for-pce-controller">[I-D.ietf-pce-pcep-extension-for-pce-controller]</b></td>
<td class="top">
<a>Zhao, Q.</a>, <a>Li, Z.</a>, <a>Negi, M.</a> and <a>C. Zhou</a>, "<a href="https://tools.ietf.org/html/draft-ietf-pce-pcep-extension-for-pce-controller-01">PCEP Procedures and Protocol Extensions for Using PCE as a Central Controller (PCECC) of LSPs</a>", Internet-Draft draft-ietf-pce-pcep-extension-for-pce-controller-01, February 2019.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-spring-segment-routing-mpls">[I-D.ietf-spring-segment-routing-mpls]</b></td>
<td class="top">
<a>Bashandy, A.</a>, <a>Filsfils, C.</a>, <a>Previdi, S.</a>, <a>Decraene, B.</a>, <a>Litkowski, S.</a> and <a>R. Shakir</a>, "<a href="https://tools.ietf.org/html/draft-ietf-spring-segment-routing-mpls-18">Segment Routing with MPLS data plane</a>", Internet-Draft draft-ietf-spring-segment-routing-mpls-18, December 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.sdt-detnet-security">[I-D.sdt-detnet-security]</b></td>
<td class="top">
<a>Mizrahi, T., Grossman, E., Hacker, A., Das, S.</a>, "<a>Deterministic Networking (DetNet) Security Considerations, draft-sdt-detnet-security, work in progress</a>", 2017.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE1588">[IEEE1588]</b></td>
<td class="top">
<a>IEEE</a>, "<a>IEEE 1588 Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems Version 2</a>", 2008.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE8021CB">[IEEE8021CB]</b></td>
<td class="top">
<a title="IEEE 802.1">Finn, N.</a>, "<a href="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf">Draft Standard for Local and metropolitan area networks - Seamless Redundancy</a>", IEEE P802.1CB /D2.1 P802.1CB, December 2015.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE8021Q">[IEEE8021Q]</b></td>
<td class="top">
<a>IEEE 802.1</a>, "<a href="http://standards.ieee.org/about/get/">Standard for Local and metropolitan area networks--Bridges and Bridged Networks (IEEE Std 802.1Q-2014)</a>", 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2205">[RFC2205]</b></td>
<td class="top">
<a>Braden, R.</a>, <a>Zhang, L.</a>, <a>Berson, S.</a>, <a>Herzog, S.</a> and <a>S. Jamin</a>, "<a href="https://tools.ietf.org/html/rfc2205">Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification</a>", RFC 2205, DOI 10.17487/RFC2205, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2474">[RFC2474]</b></td>
<td class="top">
<a>Nichols, K.</a>, <a>Blake, S.</a>, <a>Baker, F.</a> and <a>D. Black</a>, "<a href="https://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, DOI 10.17487/RFC2474, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3272">[RFC3272]</b></td>
<td class="top">
<a>Awduche, D.</a>, <a>Chiu, A.</a>, <a>Elwalid, A.</a>, <a>Widjaja, I.</a> and <a>X. Xiao</a>, "<a href="https://tools.ietf.org/html/rfc3272">Overview and Principles of Internet Traffic Engineering</a>", RFC 3272, DOI 10.17487/RFC3272, May 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3985">[RFC3985]</b></td>
<td class="top">
<a>Bryant, S.</a> and <a>P. Pate</a>, "<a href="https://tools.ietf.org/html/rfc3985">Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture</a>", RFC 3985, DOI 10.17487/RFC3985, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4448">[RFC4448]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Rosen, E.</a>, <a>El-Aawar, N.</a> and <a>G. Heron</a>, "<a href="https://tools.ietf.org/html/rfc4448">Encapsulation Methods for Transport of Ethernet over MPLS Networks</a>", RFC 4448, DOI 10.17487/RFC4448, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4872">[RFC4872]</b></td>
<td class="top">
<a>Lang, J.</a>, <a>Rekhter, Y.</a> and <a>D. Papadimitriou</a>, "<a href="https://tools.ietf.org/html/rfc4872">RSVP-TE Extensions in Support of End-to-End Generalized Multi-Protocol Label Switching (GMPLS) Recovery</a>", RFC 4872, DOI 10.17487/RFC4872, May 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4873">[RFC4873]</b></td>
<td class="top">
<a>Berger, L.</a>, <a>Bryskin, I.</a>, <a>Papadimitriou, D.</a> and <a>A. Farrel</a>, "<a href="https://tools.ietf.org/html/rfc4873">GMPLS Segment Recovery</a>", RFC 4873, DOI 10.17487/RFC4873, May 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4875">[RFC4875]</b></td>
<td class="top">
<a>Aggarwal, R.</a>, <a>Papadimitriou, D.</a> and <a>S. Yasukawa</a>, "<a href="https://tools.ietf.org/html/rfc4875">Extensions to Resource Reservation Protocol - Traffic Engineering (RSVP-TE) for Point-to-Multipoint TE Label Switched Paths (LSPs)</a>", RFC 4875, DOI 10.17487/RFC4875, May 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5440">[RFC5440]</b></td>
<td class="top">
<a>Vasseur, JP.</a> and <a>JL. Le Roux</a>, "<a href="https://tools.ietf.org/html/rfc5440">Path Computation Element (PCE) Communication Protocol (PCEP)</a>", RFC 5440, DOI 10.17487/RFC5440, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5586">[RFC5586]</b></td>
<td class="top">
<a>Bocci, M.</a>, <a>Vigoureux, M.</a> and <a>S. Bryant</a>, "<a href="https://tools.ietf.org/html/rfc5586">MPLS Generic Associated Channel</a>", RFC 5586, DOI 10.17487/RFC5586, June 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5654">[RFC5654]</b></td>
<td class="top">
<a>Niven-Jenkins, B.</a>, <a>Brungard, D.</a>, <a>Betts, M.</a>, <a>Sprecher, N.</a> and <a>S. Ueno</a>, "<a href="https://tools.ietf.org/html/rfc5654">Requirements of an MPLS Transport Profile</a>", RFC 5654, DOI 10.17487/RFC5654, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5921">[RFC5921]</b></td>
<td class="top">
<a>Bocci, M.</a>, <a>Bryant, S.</a>, <a>Frost, D.</a>, <a>Levrau, L.</a> and <a>L. Berger</a>, "<a href="https://tools.ietf.org/html/rfc5921">A Framework for MPLS in Transport Networks</a>", RFC 5921, DOI 10.17487/RFC5921, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6003">[RFC6003]</b></td>
<td class="top">
<a>Papadimitriou, D.</a>, "<a href="https://tools.ietf.org/html/rfc6003">Ethernet Traffic Parameters</a>", RFC 6003, DOI 10.17487/RFC6003, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6006">[RFC6006]</b></td>
<td class="top">
<a>Zhao, Q.</a>, <a>King, D.</a>, <a>Verhaeghe, F.</a>, <a>Takeda, T.</a>, <a>Ali, Z.</a> and <a>J. Meuric</a>, "<a href="https://tools.ietf.org/html/rfc6006">Extensions to the Path Computation Element Communication Protocol (PCEP) for Point-to-Multipoint Traffic Engineering Label Switched Paths</a>", RFC 6006, DOI 10.17487/RFC6006, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6073">[RFC6073]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Metz, C.</a>, <a>Nadeau, T.</a>, <a>Bocci, M.</a> and <a>M. Aissaoui</a>, "<a href="https://tools.ietf.org/html/rfc6073">Segmented Pseudowire</a>", RFC 6073, DOI 10.17487/RFC6073, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6387">[RFC6387]</b></td>
<td class="top">
<a>Takacs, A.</a>, <a>Berger, L.</a>, <a>Caviglia, D.</a>, <a>Fedyk, D.</a> and <a>J. Meuric</a>, "<a href="https://tools.ietf.org/html/rfc6387">GMPLS Asymmetric Bandwidth Bidirectional Label Switched Paths (LSPs)</a>", RFC 6387, DOI 10.17487/RFC6387, September 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6790">[RFC6790]</b></td>
<td class="top">
<a>Kompella, K.</a>, <a>Drake, J.</a>, <a>Amante, S.</a>, <a>Henderickx, W.</a> and <a>L. Yong</a>, "<a href="https://tools.ietf.org/html/rfc6790">The Use of Entropy Labels in MPLS Forwarding</a>", RFC 6790, DOI 10.17487/RFC6790, November 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7551">[RFC7551]</b></td>
<td class="top">
<a>Zhang, F.</a>, <a>Jing, R.</a> and <a>R. Gandhi</a>, "<a href="https://tools.ietf.org/html/rfc7551">RSVP-TE Extensions for Associated Bidirectional Label Switched Paths (LSPs)</a>", RFC 7551, DOI 10.17487/RFC7551, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7950">[RFC7950]</b></td>
<td class="top">
<a>Bjorklund, M.</a>, "<a href="https://tools.ietf.org/html/rfc7950">The YANG 1.1 Data Modeling Language</a>", RFC 7950, DOI 10.17487/RFC7950, August 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8040">[RFC8040]</b></td>
<td class="top">
<a>Bierman, A.</a>, <a>Bjorklund, M.</a> and <a>K. Watsen</a>, "<a href="https://tools.ietf.org/html/rfc8040">RESTCONF Protocol</a>", RFC 8040, DOI 10.17487/RFC8040, January 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8169">[RFC8169]</b></td>
<td class="top">
<a>Mirsky, G.</a>, <a>Ruffini, S.</a>, <a>Gray, E.</a>, <a>Drake, J.</a>, <a>Bryant, S.</a> and <a>A. Vainshtein</a>, "<a href="https://tools.ietf.org/html/rfc8169">Residence Time Measurement in MPLS Networks</a>", RFC 8169, DOI 10.17487/RFC8169, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#sec_comb" id="sec_comb">Example of DetNet Data Plane Operation</a>
</h1>
<p id="rfc.section.A.p.1">[Editor's note: Add a simplified example of DetNet data plane and how labels etc work in the case of MPLS-based PSN and utilizing PREOF. The figure is subject to change depending on the further DT decisions on the label handling..] </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jouni Korhonen</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Korhonen</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jouni.nospam@gmail.com">jouni.nospam@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bal&#225;zs Varga</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Varga</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span class="vcardline">Magyar Tudosok krt. 11.</span>

	  <span class="vcardline">
		<span class="locality">Budapest</span>,  
		<span class="region"></span>
		<span class="code">1117</span>
	  </span>
	  <span class="country-name vcardline">Hungary</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:balazs.a.varga@ericsson.com">balazs.a.varga@ericsson.com</a></span>

  </address>
</div>

</body>
</html>
