<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc3031 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3031.xml">
<!ENTITY rfc3032 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3032.xml">
<!ENTITY rfc3985 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.3985.xml">
<!ENTITY rfc4090 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4090.xml">
<!ENTITY rfc4385 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4385.xml">
<!ENTITY rfc4446 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4446.xml">
<!ENTITY rfc4447 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4447.xml">
<!ENTITY rfc4448 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4448.xml">
<!ENTITY rfc4553 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4553.xml">
<!ENTITY rfc4664 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4664.xml">
<!ENTITY rfc4817 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4817.xml">
<!ENTITY rfc4872 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4872.xml">
<!ENTITY rfc4873 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4873.xml">
<!ENTITY rfc5036 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5036.xml">
<!ENTITY rfc5086 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5086.xml">
<!ENTITY rfc5087 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5087.xml">
<!ENTITY rfc5254 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5254.xml">
<!ENTITY rfc5129 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5129.xml">
<!ENTITY rfc5305 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5305.xml">
<!ENTITY rfc5331 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5331.xml">
<!ENTITY rfc5332 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5332.xml">
<!ENTITY rfc5440 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5440.xml">
<!ENTITY rfc5462 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5462.xml">
<!ENTITY rfc5586 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5586.xml">
<!ENTITY rfc5659 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5659.xml">
<!ENTITY rfc5085 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5085.xml">
<!ENTITY rfc5921 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5921.xml">
<!ENTITY rfc5960 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.5960.xml">
<!ENTITY rfc6275 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6275.xml">
<!ENTITY rfc6371 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6371.xml">
<!ENTITY rfc6378 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6378.xml">
<!ENTITY rfc6387 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6387.xml">
<!ENTITY rfc6426 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6426.xml">
<!ENTITY rfc6437 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6437.xml">
<!ENTITY rfc6540 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6540.xml">
<!ENTITY rfc6564 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6564.xml">
<!ENTITY rfc6621 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6621.xml">
<!ENTITY rfc6658 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6658.xml">
<!ENTITY rfc6718 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6718.xml">
<!ENTITY rfc6733 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6733.xml">
<!ENTITY rfc6790 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6790.xml">
<!ENTITY rfc7271 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7271.xml">
<!ENTITY rfc7348 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7348.xml">
<!ENTITY rfc7426 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7426.xml">
<!ENTITY rfc7432 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7432.xml">
<!ENTITY rfc7510 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7510.xml">
<!ENTITY rfc8169 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8169.xml">
<!ENTITY I-D.ietf-pce-pcep-extension-for-pce-controller PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-pce-pcep-extension-for-pce-controller.xml">
<!ENTITY I-D.ietf-spring-segment-routing-mpls PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-spring-segment-routing-mpls">
<!ENTITY I-D.ietf-detnet-problem-statement PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-detnet-problem-statement.xml">
<!ENTITY I-D.ietf-detnet-architecture PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-detnet-architecture.xml">
<!ENTITY I-D.ietf-detnet-flow-information-model PUBLIC "" "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-detnet-flow-information-model.xml">
<!ENTITY I-D.ietf-mpls-residence-time SYSTEM "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-mpls-residence-time">

]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc iprnotified="no"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std"
     docName="draft-ietf-detnet-data-plane-framework-00"
         ipr="trust200902"
         submissionType="IETF">
  <front>
    <title abbrev="DetNet MPLS Data Plane">
     DetNet MPLS Data Plane Encapsulation</title>

  <author role="editor" fullname="Jouni Korhonen" initials="J." surname="Korhonen">
   <!--organization abbrev="Nordic">Nordic Semiconductor</organization-->
   <address>
    <email>jouni.nospam@gmail.com</email>
   </address>
  </author>

  <author role="editor" fullname="Bal&aacute;zs Varga" initials="B." surname="Varga">
	<organization>Ericsson</organization>
	<address>
	 <postal>
	  <street>Magyar Tudosok krt. 11.</street>
	  <city>Budapest</city>
	  <country>Hungary</country>
	  <code>1117</code>
	 </postal>
	 <email>balazs.a.varga@ericsson.com</email>
	</address>
	</author>

  <!--author fullname="Donald Fauntleroy Duck" initials="D. F." surname="Duck">
   <organization abbrev="Royal Bros.">Royal Bros.</organization>
   <address>
    <postal>
     <street>13 Paradise Road</street>
     <city>Duckburg</city>
     <region>Calisota</region>
     <country>USA</country>
    </postal>
   </address>
  </author-->
  <date />
  <workgroup>DetNet</workgroup>

  <abstract>
   <t>
     This document specifies the Deterministic Networking data plane
     when operating over an MPLS Packet Switched Networks.
   </t>
  </abstract>
  </front>

 <middle>
 <section title="Introduction" anchor="sec_intro">

  <t>
    [Editor's note: text from MPLS].
  </t>

  <t>
    Deterministic Networking (DetNet) is a service that can be offered by a
    network to DetNet flows.  DetNet provides these flows with a low packet loss
    rates and assured maximum end-to-end delivery latency.  General background
    and concepts of DetNet can be found in <xref
    target="I-D.ietf-detnet-architecture"/>.
  </t>
  <t>
    The DetNet Architecture decomposes the DetNet related data plane
    functions into two sub-layers: a service sub-layer and a forwarding sub-layer.
    The service sub-layer is used to provide DetNet service protection and
    reordering. The forwarding sub-layer is used to provides congestion
    protection (low loss, assured latency, and limited reordering)
    leveraging MPLS Traffic Engineering mechanisms.
  </t>
  <t>
    This document specifies the DetNet data plane operation and the on-wire encapsulation
    of DetNet flows over an MPLS-based Packet Switched Network (PSN). The
    specified encapsulation provides the building blocks to enable the DetNet
    service and forwarding sub-layer functions and supports flow identification as described in the
    DetNet Architecture.

   As part of the service sub-layer functions, this document describes
   DetNet node data plane operation. It also describes the
   function and operation of the Packet Replication (PRF) Packet Elimination
   (PEF) and Packet Ordering (POF) functions with an MPLS data plane.

    It also describes an MPLS-based DetNet forwarding sub-layer that eliminates (or
    reduces) contention loss  and provides bounded latency for DetNet flows.
  </t>
  <t>
    MPLS encapsulated DetNet flows can be carried over
    network technologies that can provide the DetNet required level
    of service.  This document defines examples of such, specifically
    carrying DetNet MPLS flows over IEEE 802.1 TSN sub-networks, and
    over DetNet IP PSN.
  </t>
  <t>
    The intent is for this document to support different traffic types
    being mapped over DetNet MPLS, but this is out side the scope of this
    document. An example of such can be found in <xref
    target="I-D.ietf-detnet-dp-sol-ip"/>.  This document also allows
    for, but does not define, associated controller plane
    and Operations, Administration, and Maintenance (OAM) functions.
  </t>

  <t>
    [Editor's note: text from IP].
  </t>

      <t>
        Deterministic Networking (DetNet) is a service that can be offered by a network to DetNet flows.
        DetNet provides these flows extremely low packet loss rates and assured maximum end-to-end
        delivery latency.  General background and concepts of DetNet can
        be found in the DetNet Architecture <xref target="I-D.ietf-detnet-architecture"/>.
      </t>
      <t>
        This document specifies the DetNet data plane operation for IP
        hosts and routers that provide DetNet service to IP encapsulated
        data.  No DetNet specific encapsulation is defined to support IP
        flows, rather existing IP and higher layer protocol header information is used to support
        flow identification and DetNet service delivery.
      </t>
      <t>
        The DetNet Architecture decomposes the DetNet related data plane
        functions into two sub-layers: a service sub-layer and a forwarding
        sub-layer.  The service sub-layer is used to provide DetNet service
        protection and reordering. The forwarding sub-layer is used to
        provides congestion protection (low loss, assured latency, and
        limited reordering). As no DetNet specific headers are added to
        support DetNet IP flows, only the forwarding sub-layer functions are
        supported using the DetNet IP defined by this document. Service
        protection can be provided on a per sub-net
        basis using technologies such as MPLS <!-- <xref
        target="I-D.ietf-detnet-dp-sol-mpls"/> --> and IEEE802.1 TSN.
      </t>


 </section>

 <section title="Terminology">
  <section title="Terms Used in This Document">
  <t>
   This document uses the terminology established in the DetNet architecture
   <xref target="I-D.ietf-detnet-architecture"/>, and the reader is assumed
   to be familiar with that document and its terminology.
  </t>
  <t>
   The following terminology is introduced in this document:
   <list style="hanging" hangIndent="14">

    <t hangText="F-Label">A Detnet "forwarding" label that identifies the LSP used to
    forward a DetNet flow across an MPLS PSN, e.g., a hop-by-hop
    label used between label switching routers (LSR).</t>

    <t hangText="S-Label">A DetNet "service" label that is used between DetNet
    nodes that implement also the DetNet service sub-layer functions. An S-Label is
    also used to identify a DetNet flow at DetNet service sub-layer.</t>

    <t hangText="d-CW">
	  A DetNet Control Word (d-CW) is used for sequencing and identifying duplicate packets of a DetNet flow at the DetNet service
      sub-layer. </t>
    </list>
   </t>
  </section>

  <section title="Abbreviations">
  <t>
   The following abbreviations are used in this document:
   <list style="hanging" hangIndent="14">
    <t hangText="AC">Attachment Circuit.</t>
    <t hangText="CE">Customer Edge equipment.</t>
    <t hangText="CoS">Class of Service.</t>
    <t hangText="CW">Control Word.</t>
    <t hangText="DetNet">Deterministic Networking.</t>
    <t hangText="DF">DetNet Flow.</t>
    <t hangText="DN-IWF">DetNet Inter-Working Function.</t>
    <t hangText="L2">Layer 2.</t>
    <t hangText="L2VPN">Layer 2 Virtual Private Network.</t>
    <t hangText="L3">Layer 3.</t>
    <t hangText="LSR">Label Switching Router.</t>
    <t hangText="MPLS">Multiprotocol Label Switching.</t>
    <t hangText="MPLS-TE">Multiprotocol Label Switching - Traffic Engineering.</t>
    <t hangText="MPLS-TP">Multiprotocol Label Switching - Transport Profile.</t>
    <t hangText="MS-PW">Multi-Segment PseudoWire (MS-PW).</t>
    <t hangText="NSP">Native Service Processing.</t>
    <t hangText="OAM">Operations, Administration, and Maintenance.</t>
    <t hangText="PE">Provider Edge.</t>
    <t hangText="PEF">Packet Elimination Function.</t>
    <t hangText="PRF">Packet Replication Function.</t>
    <t hangText="PREOF">Packet Replication, Elimination and Ordering Functions.</t>
    <t hangText="POF">Packet Ordering Function.</t>
    <t hangText="PSN">Packet Switched Network.</t>
    <t hangText="PW">PseudoWire.</t>
    <t hangText="QoS">Quality of Service.</t>
    <t hangText="S-PE">Switching Provider Edge.</t>
    <t hangText="T-PE">Terminating Provider Edge.</t>
    <t hangText="TSN">Time-Sensitive Network.</t>
   </list>
  </t>
  </section>
 </section>  <!-- end of terminology -->

 <section title="DetNet Data Plane Overview" anchor="sec_dt_dp">
  <section title="Layers of DetNet Data Plane" anchor="sec_lay_dt_dp">
  <t>
    This document describes how DetNet flows are carried over MPLS
    networks. The DetNet Architecture, <xref
    target="I-D.ietf-detnet-architecture"/>, decomposes the DetNet data
    plane into two sub-layers: a service sub-layer and a forwarding sub-layer.  The
    basic approach defined in this document supports the DetNet service
    sub-layer based on existing pseudowire (PW) encapsulations and
    mechanisms, and supports the DetNet forwarding sub-layer based on
    existing MPLS Traffic Engineering encapsulations and mechanisms.
    Background on PWs can be found in <xref target="RFC3985"/> and <xref
    target="RFC3031"/>. Background on MPLS Traffic Engineering can be
    found in <xref target="RFC3272"/> and <xref target="RFC3209"/>.
  </t>
  <figure anchor="dn_mpls_dp_approach" align="center"
          title="DetNet Adaptation to MPLS Data Plane">
    <artwork align="center"><![CDATA[
  DetNet        MPLS
    .
    .
+------------+
|  Service   | d-CW, S-Label
+------------+
| Forwarding | F-Label(s)
+------------+
    .
    .
]]></artwork>
</figure>

  <t>
    The DetNet MPLS data plane approach defined in this document is
    shown in <xref target="dn_mpls_dp_approach"/>.  The service sub-layer is
    supported by a DetNet control word (d-CW) which conforms to the
    Generic PW MPLS Control Word (PWMCW) defined in <xref
    target="RFC4385"/>.  A d-CW identifying service label (S-Label) is
    also used.
  </t>

 <t>
  A node operating on a DetNet flow in the Detnet service sub-layer, i.e. a node processing a
  DetNet packet which has the S-Label as top of stack uses the local context
  associated with that S-Label, for example a received F-Label, to
  determine what local DetNet operation(s) are
  applied to that packet. An S-Label may be unique when taken from the platform
  label space <xref target="RFC3031"/>, which would enable correct DetNet flow
  identification regardless of which input interface or LSP the packet arrives on.
 </t>

  <t>
    The DetNet MPLS data plane builds on MPLS Traffic Engineering
    encapsulations and mechanisms to provide a forwarding sub-layer that
    is responsible for providing resource allocation and explicit
    routes.  The forwarding sub-layer is supported by one or more
    forwarding labels (F-Labels).
  </t>

  </section>

  <section title="DetNet Data Plane Scenarios"
           anchor="sec_mpls_dt_dp_scen">

  <t>
    [Editor's note: WE NEED NEW FIGURES HERE (see presentation slide 4 or slide 21 are good inputs) and pointers to the splitted documents].
  </t>

  </section>
</section>  <!-- end of data plane overview -->



    <section title="DetNet IP Data Plane Overview" anchor="sec_dt_ip_dp">
<!-- 
 -->

  <t>
    [Editor's note: To be merged with previous section].
  </t>

      <t>
        This document describes how IP is used by DetNet nodes, i.e.,
        hosts and routers, to identify DetNet flows and provide a DetNet
        service. From a data plane perspective, an end-to-end IP model
        is followed.  As mentioned above, existing IP and higher layer
        protocol header information is used to support flow
        identification and DetNet service delivery.
      </t>
      <t>
        DetNet uses "6-tuple" based flow identification, where "6-tuple"
        refers to information carried in IP and higher layer protocol
        headers. General background on the use of IP headers, and
        "5-tuples", to identify flows and support Quality of Service
        (QoS) can be found in <xref target="RFC3670"/>.  <xref
        target="RFC7657"/> also provides useful background on the
        delivery differentiated services (DiffServ) and "6-tuple" based
        flow identification.
      </t>
      <t>
        DetNet flow aggregation may be enabled via the use of
        wildcards, masks, prefixes and ranges. IP tunnels may also be
        used to support flow aggregation. In these cases, it is
        expected that DetNet aware intermediate nodes will provide
        DetNet service assurance on the aggregate through resource
        allocation and congestion control mechanisms.
      </t>
      <figure align="center" anchor="fig_ip_detnet_simple"
              title="A Simple DetNet (DN) Enabled IP Network">
        <artwork><![CDATA[
 DetNet IP       Relay                        Relay       DetNet IP
 End System      Node                         Node        End System

+----------+                                             +----------+
|   Appl.  |<------------ End to End Service ----------->|   Appl.  |
+----------+  ............                 ...........   +----------+
| Service  |<-: Service  :-- DetNet flow --: Service  :->| Service  |
+----------+  +----------+                 +----------+  +----------+
|Forwarding|  |Forwarding|                 |Forwarding|  |Forwarding|
+--------.-+  +-.------.-+                 +-.---.----+  +-------.--+
         : Link :       \      ,-----.      /     \   ,-----.   /
         +......+        +----[  Sub  ]----+       +-[  Sub  ]-+
                              [Network]              [Network]
                               `-----'                `-----'

         |<--------------------- DetNet IP --------------------->|
                         ]]></artwork>
      </figure>
      <t>
        <xref target="fig_ip_detnet_simple"/> illustrates a DetNet enabled IP
        network.  The DetNet enabled end systems originate IP encapsulated
        traffic that is identified as DetNet flows, relay nodes understand the
        forwarding requirements of the DetNet flow and ensure that node,
        interface and sub-network resources are allocated to ensure DetNet
        service requirements. The dotted line around the Service component of
        the Relay Nodes indicates that the transit routers are DetNet service
        aware but do not perform any DetNet service sub-layer function, e.g., PREOF.
        IEEE 802.1 TSN is an example sub-network type which can provide support
        for DetNet flows and service.  The mapping of DetNet IP flows to TSN
        streams and TSN protection mechanisms is covered in <!-- <xref
        target="mapping-tsn"/> -->.
      </t>
      <t>
        Note: The sub-network can represent a TSN, MPLS or IP network
        segment.
      </t>

      <figure align="center" anchor="fig_ip_detnet"
              title="DetNet IP Over DetNet MPLS Network">
        <artwork><![CDATA[
 DetNet IP       Relay         Transit         Relay       DetNet IP
 End System      Node           Node           Node        End System

+----------+                                              +----------+
|   Appl.  |<-------------- End to End Service ---------->|   Appl.  |
+----------+   .....-----+                  +-----.....   +----------+
| Service  |<--: Service |-- DetNet flow ---| Service :-->| Service  |
|          |   :         |<- DN MPLS flow ->|         :   |          |
+----------+   +---------+   +----------+   +---------+   +----------+
|Forwarding|   |Fwd| |Fwd|   |Forwarding|   |Fwd| |Fwd|   |Forwarding|
+--------.-+   +-.-+ +-.-+   +---.----.-+   +-.-+ +-.-+   +----.-----+
         :  Link :    /  ,-----.  \   :  Link :    /  ,-----.  \
         +.......+    +-[  Sub  ]-+   +.......+   +--[  Sub  ]--+
                        [Network]                    [Network]
                         `-----'                      `-----'

                       |<---- DetNet MPLS --->|
         |<--------------------- DetNet IP ------------------->|
                         ]]></artwork>
      </figure>
      <t>
        <xref target="fig_ip_detnet"/> illustrates a variant of <xref
        target="fig_ip_detnet_simple"/>, with an MPLS based DetNet
        network as a sub-network between the relay nodes.  It shows a
        more complex DetNet enabled IP network where an IP flow is
        mapped to one or more PWs and MPLS (TE) LSPs.  The end systems
        still originate IP encapsulated traffic that is identified as
        DetNet flows.  The relay nodes follow procedures defined in
        XXX <!-- <xref target="ip-over-mpls"/> --> to map each DetNet
        flow to MPLS LSPs. While not shown, relay nodes can provide
        service sub-layer functions such as PREOF using DetNet over MPLS,
        and this is indicated by the solid line for the MPLS
        facing portion of the Service component. Note that the Transit
        node is MPLS (TE) LSP aware and performs switching based on MPLS
        labels, and need not have any specific knowledge of the DetNet
        service or the corresponding DetNet flow identification. See
        XXX <!-- <xref target="ip-over-mpls"/> --> for details on the mapping of IP
        flows to MPLS, and <!-- <xref target="I-D.ietf-detnet-dp-sol-mpls"/> -->
        for general support of DetNet services using MPLS.
      </t>
      <figure align="center" anchor="fig_non_detnet_ip"
              title="Non-DetNet aware IP end systems with DetNet IP Domain">
        <artwork><![CDATA[
 IP              Edge                         Edge         IP
 End System      Node                         Node         End System

+----------+   +.........+                  +.........+   +----------+
|   Appl.  |<--:Svc Proxy:-- E2E Service ---:Svc Proxy:-->|   Appl.  |
+----------+   +.........+                  +.........+   +----------+
|    IP    |<--:IP : :Svc:----- IP flow ----:Svc: :IP :-->|    IP    |
+----------+   +---+ +---+                  +---+ +---+   +----------+
|Forwarding|   |Fwd| |Fwd|                  |Fwd| |Fwd|   |Forwarding|
+--------.-+   +-.-+ +-.-+                  +-.-+ +-.-+   +---.------+
         :  Link :      \       ,-----.      /     /  ,-----.  \
         +.......+       +-----[  Sub  ]----+     +--[  Sub  ]--+
                               [Network]             [Network]
                                `-----'               `-----'

      |<--- IP --->| |<------ DetNet IP ------->| |<--- IP --->|
                         ]]></artwork>
      </figure>
      <t>
        <xref target="fig_non_detnet_ip"/> illustrates another variant of <xref
        target="fig_ip_detnet_simple"/> where the end systems are not DetNet
        aware.  In this case, edge nodes sit at the boundary of the DetNet
        domain and provide DetNet service proxies for the end applications by
        initiating and terminating DetNet service for the application's IP
        flows.  The existing header information or an approach such as described
        in XXX <!-- <xref target="aggregation"/> --> can be used to support DetNet flow
        identification.
      </t>
      <t>
        Non-DetNet and DetNet IP packets are identical on the wire. From
        data plane perspective, the only difference is that there is
        flow-associated DetNet information on each DetNet node that
        defines the flow related characteristics and required forwarding
        behavior.  As shown above, edge nodes provide a Service Proxy
        function that "associates" one or more IP flows with the
        appropriate DetNet flow-specific information and ensures that
        the receives the proper traffic treatment within the domain.
      </t>
      <t>
        Note: The operation of IEEE802.1 TSN end systems over DetNet
        enabled IP networks is not described in this document.  While
        TSN flows could be encapsulated in IP packets by an IP End
        System or DetNet Edge Node in order to produce DetNet IP flows,
        the details of such are out of scope of this document.
      </t>

    </section>




<!-- ================================================================= -->
<!-- =================== General Encap considerations ================ -->
<!-- ================================================================= -->

<section title="DetNet MPLS Data Plane Considerations" anchor="dn-gen-encap-solution">

  <t>
    [Editor's note: Let's how it can be generalized for the framework document].
  </t>

  <t>
    This section provides informative considerations related to
    providing DetNet service to flows which are identified
    based on their header information. At a high level, the
    following are provided on a per flow basis:
    <list style="hanging">
      <t hangText="Eliminating contention loss and jitter reduction:">
        <vspace blankLines="1"/>
        Use of allocated resources (queuing, policing, shaping) to ensure
        that the congestion-related loss and latency/jitter requirements of
        a DetNet flow are met.
      </t>
      <t hangText="Explicit routes:">
        <vspace blankLines="1"/>
        Use of a specific path for a flow.  This limits
        misordering and bounds latency.
      </t>

      <t hangText="Service protection:">
        <vspace blankLines="1"/>
        Which in the case of this document primarily relates to
        replication and elimination. Changing the explicit path after a
        failure is detected in order to restore delivery of the required
        DetNet service characteristics is also possible. Path changes,
        even in the case of failure recovery, can lead to the out of
        order delivery of data.
      </t>
      <t hangText="Load sharing:">
        <vspace blankLines="1"/>
        Generally, distributing packets of the same DetNet flow over
        multiple paths is not recommended. Such load sharing,
        e.g., via ECMP or UCMP, impacts ordering and possibly jitter.
      </t>
      <t hangText="Troubleshooting:"> <vspace blankLines="1"/>
      For example, to support identification of misbehaving flows.
      </t>
      <t hangText="Recognize flow(s) for analytics:"><vspace blankLines="1"/>
      For example, increase counters.
      </t>
      <t hangText="Correlate events with flows:"><vspace blankLines="1"/>
      For example, unexpected loss.
      </t>
    </list>
  </t>

  <t>
  The DetNet data plane also allows for the aggregation of DetNet flows, e.g., via MPLS hierarchical
  LSPs, to improved scaling.  When DetNet flows are aggregated, transit
  nodes provide service to the aggregate and not on a per-DetNet flow
  basis.  In this case, nodes performing aggregation will ensure that
  per-flow service requirements are achieved.
 </t>

 <section title="End-System Specific Considerations">
  <t>
   Data-flows requiring DetNet service are generated and terminated on
   end-systems. Encapsulation depends on application and its
   preferences. In a DetNet MPLS domain the DN functions use the d-CWs,
   S-Labels and F-Labels to provide DetNet services. However, an
   application may exchange further flow related parameters (e.g.,
   time-stamp), which are not provided by DN functions.
  </t>

  <t>
    Specifics related to non-MPLS DetNet end station behavior are out
    side the scope of this document.  For example, details on support
    for DetNet IP data flows can be found in <xref
    target="I-D.ietf-detnet-dp-sol-ip"/>. This document is also useful
    for end stations that map IP flows to DetNet flows.
  </t>
  <t>
   As a general rule, DetNet MPLS domains are capable of forwarding any
   DetNet MPLS flows and the DetNet domain does not mandate the
   end-system or edge system encapsulation format. Unless there is a
   proxy of some form present, end-systems peer with similar end-systems
   using the same application encapsulation format.  For example, as
   shown in <xref target="fig_es_connect"/>, IP applications peer with
   IP applications and Ethernet L2VPN applications peer with Ethernet
   L2VPN applications.
  </t>

  <figure title="End-Systems and The DetNet MPLS Domain" anchor="fig_es_connect">
  <artwork align="center"><![CDATA[
+-----+
|  X  |                               +-----+
+-----+                               |  X  |
| Eth |               ________        +-----+
+-----+     _____    /        \       | Eth |
       \   /     \__/          \___   +-----+
        \ /                        \ /
         0======== tunnel-1 ========0_
         |                             \
          \                             |
          0========= tunnel-2 =========0
         / \                        __/ \
  +-----+   \__ DetNet MPLS domain /     \
  |  X  |      \         __       /       +-----+
  +-----+       \_______/  \_____/        |  X  |
  |  IP |                                 +-----+
  +-----+                                 |  IP |
                                          +-----+
  ]]>
    </artwork></figure>

 </section>
 <section title="Sub-Network Considerations">
   <t>
     As shown in <!-- <xref target="fig_dn_mpls_detnet"/> -->, MPLS nodes are
     interconnected by different sub-network technologies, which may
     include point-to-point links. Each of these need to provide
     appropriate service to DetNet flows.  In some cases, e.g., on
     dedicated point-to-point links or TDM technologies, all that is
     required is for a DetNet node to appropriately queue its output
     traffic.  In other cases, DetNet nodes will need to map DetNet
     flows to the flow semantics (i.e., identifiers) and mechanisms used
     by an underlying sub-network technology.  <xref
     target="fig_dn_mpls_sn_ex"/> shows several examples of header
     formats that can be used to carry DetNet MPLS flows over different
     sub-network technologies.  L2 represent a generic layer-2
     encapsulation that might be used on a point-to-point link.  TSN
     represents the encapsulation used on an IEEE 802.1 TSN network, as
     described in <!-- <xref target="mpls-over-tsn"/> -->.  UDP/IP represents the
     encapsulation used on a DetNet IP PSN, as described in <!-- <xref
     target="mpls-over-ip"/> -->.     
   </t>
   

  <figure title="Example DetNet MPLS Sub-Network Formats" anchor="fig_dn_mpls_sn_ex">
  <artwork align="center"><![CDATA[

                   +------+  +------+  +------+
App-Flow           |  X   |  |  X   |  |  X   |
             +-----+======+--+======+--+======+-----+
DetNet-MPLS        | d-CW |  | d-CW |  | d-CW |
                   +------+  +------+  +------+
                   |Labels|  |Labels|  |Labels|
             +-----+======+--+======+--+======+-----+
Sub-Network        |  L2  |  | TSN  |  | UDP  |
                   +------+  +------+  +------+
                                       |  IP  |
                                       +------+
                                       |  L2  |
                                       +------+
    ]]>
  </artwork></figure>
 </section>
</section>

<!-- ================================================================= -->
<!-- ===================================================================== -->



<section title="Security Considerations">
  <t>
   The security considerations of DetNet in general are discussed in
   <xref target="I-D.ietf-detnet-architecture"/>
   and <xref target="I-D.sdt-detnet-security"/>. Other security
   considerations will be added in a future version of
   this draft.
  </t>
</section>


<section anchor="iana" title="IANA Considerations">
  <t>
   This document makes no IANA requests.
  </t>
</section>

<section anchor="Contributors" title="Contributors">
 <t>RFC7322 limits the number of authors listed on the front page of a draft to a maximum of 5,
  far fewer than the many individuals below who made important contributions to this draft. The
  editor wishes to thank and acknowledge each of the following authors for contributing text to
  this draft. See also <xref target="acks"/>.
 </t>
 <figure> <artwork><![CDATA[
   Loa Andersson
   Huawei
   Email: loa@pi.nu

   Yuanlong Jiang
   Huawei
   Email: jiangyuanlong@huawei.com

   Norman Finn
   Huawei
   3101 Rio Way
   Spring Valley, CA  91977
   USA
   Email: norman.finn@mail01.huawei.com

   Janos Farkas
   Ericsson
   Magyar Tudosok krt. 11.
   Budapest  1117
   Hungary
   Email: janos.farkas@ericsson.com

   Carlos J. Bernardos
   Universidad Carlos III de Madrid
   Av. Universidad, 30
   Leganes, Madrid  28911
   Spain
   Email: cjbc@it.uc3m.es

   Tal Mizrahi
   Marvell
   6 Hamada st.
   Yokneam
   Israel
   Email: talmi@marvell.com

   Lou Berger
   LabN Consulting, L.L.C.
   Email: lberger@labn.net

   Stewart Bryant
   Huawei Technologies
   Email: stewart.bryant@gmail.com

   Mach Chen
   Huawei Technologies
   Email: mach.chen@huawei.com

   Andrew G. Malis
   Huawei Technologies
   Email: agmalis@gmail.com
   ]]></artwork>
 </figure>

</section>


<section anchor="acks" title="Acknowledgements">
  <t>The author(s) ACK and NACK.
  </t>
  <t> The following people were part of the DetNet Data Plane Solution Design Team:
  <list style="bullets">
   <t>Jouni Korhonen</t>
   <t>J&aacute;nos Farkas</t>
   <t>Norman Finn</t>
   <t>Bal&aacute;zs Varga</t>
   <t>Loa Andersson</t>
   <t>Tal Mizrahi</t>
   <t>David Mozes</t>
   <t>Yuanlong Jiang</t>
   <t>Andrew Malis</t>
   <t>Carlos J. Bernardos</t>
  </list></t>
  <t>
   The DetNet chairs serving during the DetNet Data Plane Solution Design Team:
   <list style="bullets">
    <t>Lou Berger</t>
    <t>Pat Thaler</t>
   </list></t>
   <t>
    Thanks for Stewart Bryant for his extensive review of the previous
    versions of the document.
   </t>
</section>
</middle>

<back>
  <references title="Normative References">
   &rfc2119;
   <?rfc include="reference.RFC.2211"?>
   <?rfc include="reference.RFC.2212"?>
   <?rfc include="reference.RFC.3031"?>
   <?rfc include="reference.RFC.3032"?>
   <?rfc include="reference.RFC.3209"?>
   <?rfc include="reference.RFC.3270"?>
   <?rfc include="reference.RFC.3443"?>
   <?rfc include="reference.RFC.3473"?>
   <?rfc include="reference.RFC.4206"?>
   <?rfc include="reference.RFC.5129"?>
   <?rfc include="reference.RFC.5085"?>
   <?rfc include="reference.RFC.5462"?>
   &rfc4385;
   &rfc7510;
   <?rfc include="reference.RFC.8174"?>
  </references>
  <references title="Informative References">
   <?rfc include="reference.RFC.2205"?>
   <?rfc include="reference.RFC.2474"?>
   <?rfc include="reference.RFC.3272"?>
   &rfc3985;
   &rfc4448;
   &rfc4872;
   &rfc4873;
      <?rfc include="reference.RFC.7657"?>
      <?rfc include="reference.RFC.3670"?>
   <?rfc include="reference.RFC.4875"?>
   <?rfc include="reference.RFC.5440"?>
   <?rfc include="reference.RFC.5586"?>
   <?rfc include="reference.RFC.5654"?>
   <?rfc include="reference.RFC.5921"?>
   <?rfc include="reference.RFC.6073"?>
   <?rfc include="reference.RFC.6003"?>
   <?rfc include="reference.RFC.6006"?>
  &rfc6387;
    <?rfc include="reference.RFC.6790"?>
   <?rfc include="reference.RFC.7950"?>
   <?rfc include="reference.RFC.7551"?>
   <?rfc include="reference.RFC.8040"?>
   &I-D.ietf-pce-pcep-extension-for-pce-controller;
&I-D.ietf-detnet-architecture;
&I-D.ietf-detnet-flow-information-model;
   &I-D.ietf-spring-segment-routing-mpls;
   <reference anchor='I-D.ietf-detnet-dp-sol-ip'>
     <front>
       <title>DetNet IP Data Plane Encapsulation
       </title>
       <author>
         <organization>Korhonen, J., Varga, B.</organization>
       </author>
       <date year='2018' />
     </front>
   </reference>
   &rfc8169;

   <reference anchor='I-D.sdt-detnet-security'>
    <front>
     <title>Deterministic Networking (DetNet) Security Considerations,
		draft-sdt-detnet-security, work in progress
     </title>
     <author>
      <organization>Mizrahi, T., Grossman, E., Hacker, A., Das, S.</organization>
     </author>
     <date year='2017' />
    </front>
   </reference>

   <reference anchor='IEEE1588'>
     <front>
       <title>IEEE 1588 Standard for a Precision Clock Synchronization
       Protocol for Networked Measurement and Control Systems Version 2
       </title>
       <author>
         <organization>IEEE</organization>
       </author>
       <date year='2008' />
     </front>
   </reference>

   <reference anchor="IEEE8021Q"
     target="http://standards.ieee.org/about/get/">
    <front>
     <title>Standard for Local and metropolitan area networks--Bridges and Bridged Networks (IEEE Std 802.1Q-2014)</title>
     <author>
      <organization>IEEE 802.1</organization>
     </author>
     <date year="2014"/>
    </front>
    <format type="PDF" target="http://standards.ieee.org/about/get/"/>
   </reference>

   <reference anchor="IEEE8021CB"
    target="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf">
    <front>
        <title>Draft Standard for Local and metropolitan area networks - Seamless Redundancy</title>
        <author initials="N. F." surname="Finn" fullname="Norman Finn">
            <organization>IEEE 802.1</organization>
        </author>
        <date month="December" year="2015"/>
    </front>
    <seriesInfo name="IEEE P802.1CB /D2.1" value="P802.1CB"/>
    <format type="PDF" target="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf"/>
   </reference>

   <reference anchor="G.8275.1"
              target="https://www.itu.int/rec/T-REC-G.8275.1/en">
     <front>
       <title>Precision time protocol telecom profile for phase/time synchronization with full timing support from the network</title>
       <author>
         <organization>International Telecommunication Union</organization>
       </author>
       <date month="June" year="2016"/>
     </front>
     <seriesInfo name="ITU-T G.8275.1/Y.1369.1" value="G.8275.1"/>
   </reference>

   <reference anchor="G.8275.2"
              target="https://www.itu.int/rec/T-REC-G.8275.2/en">
     <front>
       <title>Precision time protocol telecom profile for phase/time synchronization with partial timing support from the network</title>
       <author>
         <organization>International Telecommunication Union</organization>
       </author>
       <date month="June" year="2016"/>
     </front>
     <seriesInfo name="ITU-T G.8275.2/Y.1369.2" value="G.8275.2"/>
   </reference>

  </references>
 <section title="Example of DetNet Data Plane Operation" anchor="sec_comb">
  <t>
   [Editor's note: Add a simplified example of DetNet data plane and how labels etc
   work in the case of MPLS-based PSN and utilizing PREOF. The figure is subject
   to change depending on the further DT decisions on the label handling..]
  </t>
 </section>

 </back>
</rfc>
